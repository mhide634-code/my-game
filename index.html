<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Chem-Verse: Complete Art</title>
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700;900&family=Orbitron:wght@700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #1a1a1d; --accent: #f1c40f; --primary: #3498db; --danger: #e74c3c; --success: #2ecc71;
            --card-bg: #2c3e50; --card-frame: #bdc3c7;
            --rare-n: #95a5a6; --rare-r: #3498db; --rare-sr: #9b59b6; --rare-ssr: #f1c40f;
        }
        body { font-family: 'M PLUS Rounded 1c', sans-serif; background-color: var(--bg-color); color: white; margin: 0; user-select: none; overflow: hidden; height: 100vh; width: 100vw; -webkit-tap-highlight-color: transparent; }

        /* --- ÁîªÈù¢Âà∂Âæ° --- */
        .screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; background: linear-gradient(135deg, #0f0c29, #302b63, #24243e); z-index: 100; transition: opacity 0.3s; }
        .hidden { display: none !important; opacity: 0; pointer-events: none; }
        .scrollable { overflow-y: auto; justify-content: flex-start; padding: 20px; }

        /* --- CSS„Ç¢„Éº„Éà („Ç§„É©„Çπ„ÉàÊèèÁîª) --- */
        .css-art { width: 100%; height: 100%; position: relative; display: flex; justify-content: center; align-items: center; font-size: 28px; }
        
        /* Â±ûÊÄßÂà•„Ç§„É©„Çπ„ÉàÂÆöÁæ© */
        .art-p-gas { background: linear-gradient(to top right, #a1c4fd, #c2e9fb); }
        .art-p-gas::after { content: '‚òÅÔ∏è'; filter: drop-shadow(0 0 5px white); animation: float 3s infinite ease-in-out; }
        
        .art-p-liquid { background: linear-gradient(to bottom, #4facfe, #00f2fe); }
        .art-p-liquid::after { content: 'üíß'; animation: bounce 2s infinite; }
        
        .art-p-solid { background: linear-gradient(to bottom, #e6b980, #eacda3); }
        .art-p-solid::after { content: 'ü™®'; }
        
        .art-p-metal { background: linear-gradient(135deg, #bdc3c7, #2c3e50); }
        .art-p-metal::after { content: '‚ú®'; text-shadow: 0 0 5px white; animation: spin 5s infinite linear; }
        
        .art-p-toxic { background: linear-gradient(to bottom, #f093fb, #f5576c); }
        .art-p-toxic::after { content: '‚ò†Ô∏è'; filter: drop-shadow(0 0 5px purple); }
        
        .art-p-fire { background: linear-gradient(to top, #e74c3c, #f1c40f); }
        .art-p-fire::after { content: 'üî•'; animation: pulse 0.5s infinite; }
        
        .art-p-gold { background: radial-gradient(circle, #ffd700, #b8860b); }
        .art-p-gold::after { content: 'üíé'; filter: drop-shadow(0 0 5px gold); }

        /* „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ */
        @keyframes float { 50% { transform: translateY(-5px); } }
        @keyframes bounce { 50% { transform: scale(1.1); } }
        @keyframes spin { 100% { filter: hue-rotate(360deg); } }
        @keyframes pulse { 50% { opacity: 0.7; } }

        /* --- „Çø„Ç§„Éà„É´ÁîªÈù¢ --- */
        .particle { position: absolute; border-radius: 50%; background: rgba(255,255,255,0.5); animation: floatUpParticle linear infinite; z-index: 0; }
        @keyframes floatUpParticle { from { transform: translateY(100vh) scale(0); opacity: 0; } to { transform: translateY(-10vh) scale(1); opacity: 1; } }
        .game-logo { font-family: 'Orbitron', sans-serif; font-size: 40px; color: var(--accent); text-shadow: 0 0 20px var(--accent); margin-bottom: 20px; z-index: 10; text-align: center; }
        .menu-container { display: flex; flex-direction: column; gap: 15px; width: 80%; max-width: 300px; z-index: 10; }
        .menu-btn { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 15px 40px; border-radius: 30px; font-weight: bold; cursor: pointer; text-align: center; backdrop-filter: blur(5px); }
        .menu-btn.primary { background: linear-gradient(90deg, var(--primary), #2980b9); border: none; }
        .menu-btn.disabled { opacity: 0.5; cursor: not-allowed; }

        /* --- „Éá„ÉÉ„Ç≠ÈÅ∏Êäû & Âõ≥Èëë --- */
        .grid-container { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; width: 100%; max-width: 600px; padding: 20px; box-sizing: border-box; overflow-y: auto; }
        .list-card { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); padding: 15px; border-radius: 12px; cursor: pointer; min-height: 80px; display: flex; flex-direction: column; justify-content: space-between; }
        .back-btn { position: fixed; bottom: 20px; background: #333; padding: 10px 30px; border-radius: 20px; z-index: 200; cursor: pointer; }

        /* --- „Ç≤„Éº„É†„Éú„Éº„Éâ --- */
        #game-board { display: none; flex-direction: column; height: 100vh; background: #111; position: relative; }
        #info-area { height: 12%; background: rgba(30,30,40,0.95); display: flex; justify-content: space-between; align-items: center; padding: 0 10px; z-index: 10; border-bottom: 1px solid #444; border-top: 1px solid #444; }
        .area { display: flex; justify-content: center; align-items: center; }
        #enemy-hand-area { height: 10%; background: rgba(0,0,0,0.3); gap: -10px; }
        #enemy-field { height: 24%; border-bottom: 2px solid #333; }
        #player-field { height: 24%; border-top: 2px solid #333; }
        #player-hand-area { height: 30%; background: rgba(0,0,0,0.2); overflow-x: auto; justify-content: flex-start; padding: 0 10px; gap: 5px; align-items: center; display: flex; }

        /* --- „Ç´„Éº„Éâ„Éá„Ç∂„Ç§„É≥ --- */
        .card { width: 85px; height: 125px; background: var(--card-bg); border-radius: 6px; border: 2px solid var(--card-frame); box-shadow: 0 4px 8px rgba(0,0,0,0.5); display: flex; flex-direction: column; padding: 3px; position: relative; flex-shrink: 0; margin: 2px; transition: transform 0.1s; overflow: hidden; box-sizing: border-box; }
        .card[data-rarity="N"] { border-color: var(--rare-n); }
        .card[data-rarity="R"] { border-color: var(--rare-r); box-shadow: 0 0 4px var(--rare-r); }
        .card[data-rarity="SR"] { border-color: var(--rare-sr); box-shadow: 0 0 6px var(--rare-sr); background: linear-gradient(135deg, #2c3e50, #4a235a); }
        .card[data-rarity="SSR"] { border-color: var(--rare-ssr); box-shadow: 0 0 8px var(--rare-ssr); background: linear-gradient(135deg, #f1c40f, #e67e22, #f1c40f); animation: shine 3s infinite linear; }
        @keyframes shine { 0% { filter: brightness(1); } 50% { filter: brightness(1.2); } 100% { filter: brightness(1); } }

        .c-head { display: flex; justify-content: space-between; align-items: center; padding: 2px 4px; font-size: 8px; font-weight: bold; color: #eee; margin-bottom: 2px; background: rgba(0,0,0,0.3); }
        .c-art-box { width: 100%; height: 60px; background: #000; position: relative; border: 1px solid #555; border-radius: 2px; overflow: hidden; }
        .c-text-box { flex-grow: 1; padding: 2px; font-size: 7px; color: #ddd; background: rgba(255,255,255,0.05); overflow: hidden; line-height: 1.1; display:flex; align-items:center; justify-content:center; text-align:center;}
        .c-stats-box { display: flex; justify-content: space-between; font-weight: 900; font-size: 11px; padding: 2px 4px; background: rgba(0,0,0,0.6); margin-top: auto; }
        .stat-atk { color: #e67e22; } .stat-hp { color: #2ecc71; }

        .badges { position: absolute; top: 68px; right: 2px; display: flex; gap: 1px; z-index: 5; }
        .bdg { width: 12px; height: 12px; border-radius: 50%; font-size: 8px; display: flex; align-items: center; justify-content: center; border: 1px solid white; box-shadow: 1px 1px 2px black; }
        .bdg-w { background: var(--primary); } .bdg-t { background: #8e44ad; } .bdg-s { background: var(--accent); } .bdg-h { background: var(--rare-n); }

        .card.selected { transform: translateY(-15px) scale(1.05); border-color: var(--accent); box-shadow: 0 0 15px var(--accent); z-index: 100; }
        .card.can-attack { border-color: var(--success); box-shadow: 0 0 10px var(--success); }
        .card.attacking { transform: scale(1.2); border-color: var(--danger); box-shadow: 0 0 20px var(--danger); z-index: 200; }
        .valid-target { animation: pulse 0.8s infinite; border-color: var(--danger)!important; }

        /* UI„Éë„Éº„ÉÑ */
        .leader { text-align: center; width: 70px; }
        .hp-circle { background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; border-radius: 50%; width: 38px; height: 38px; line-height: 38px; font-weight: bold; font-size: 16px; margin: 0 auto; border: 2px solid white; box-shadow: 0 0 8px red; }
        .action-overlay { position: absolute; bottom: 33%; right: 10px; display: flex; flex-direction: column; gap: 10px; z-index: 50; }
        .game-btn { padding: 12px 18px; border-radius: 25px; border: none; font-weight: bold; color: white; cursor: pointer; box-shadow: 0 4px 5px rgba(0,0,0,0.5); }
        .btn-draw { background: linear-gradient(to right, #27ae60, #2ecc71); } 
        .btn-syn { background: linear-gradient(to right, #f39c12, #f1c40f); color: #333; }
        #btn-end-turn { padding: 6px 12px; background: #e67e22; border-radius: 15px; border: none; color: white; font-weight: bold; }
        #cancel-btn { display: none; position: absolute; top: 60%; left: 50%; transform: translate(-50%, -50%); background: var(--danger); color: white; padding: 10px 20px; border-radius: 20px; font-weight: bold; z-index: 200; box-shadow: 0 0 10px var(--danger); cursor: pointer; }

        /* „É¢„Éº„ÉÄ„É´ */
        #msg-box { position: absolute; top: 45%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.9); padding: 15px 30px; border-radius: 8px; border: 2px solid white; font-size: 20px; font-weight: bold; pointer-events: none; opacity: 0; transition: 0.3s; z-index: 5000; white-space: nowrap; }
        
        #card-detail-panel { position: absolute; top: 10%; left: 50%; transform: translateX(-50%); width: 85%; max-width: 300px; background: rgba(20,20,30,0.98); border: 2px solid var(--accent); border-radius: 12px; padding: 20px; display: none; flex-direction: column; z-index: 3000; box-shadow: 0 0 40px black; }
        .big-art-frame { width: 100%; height: 150px; border: 2px solid #555; margin: 10px 0; border-radius: 8px; }
        
        #skill-modal { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 4000; flex-direction: column; justify-content: center; align-items: center; padding: 20px; box-sizing: border-box; }
        .sk-btn { background: white; color: #333; padding: 15px; width: 100%; max-width: 300px; margin-bottom: 10px; border-radius: 8px; font-weight: bold; cursor: pointer; border-left: 5px solid var(--primary); }
        
        #res-scr { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 6000; display: none; flex-direction: column; align-items: center; justify-content: center; }
        .res-tit { font-size: 48px; font-weight: bold; font-family: 'Orbitron'; margin-bottom: 20px; }
        .res-win { color: var(--accent); } .res-lose { color: var(--danger); }
        .confetti { position: absolute; width: 10px; height: 10px; background: #f00; animation: fall linear forwards; }
        @keyframes fall { to { transform: translateY(110vh) rotate(720deg); } }

        #craft-list { position: absolute; bottom: 38%; left: 10px; display: flex; flex-direction: column; gap: 5px; z-index: 40; pointer-events: none; }
        .craft-btn { background: rgba(0,0,0,0.9); border: 1px solid var(--accent); padding: 6px 12px; border-radius: 5px; pointer-events: auto; font-size: 12px; color: white; cursor: pointer; box-shadow: 0 0 5px var(--accent); }
    </style>
</head>
<body>

<div id="title-screen" class="screen">
    <div id="particles"></div>
    <div class="game-logo">CHEM-VERSE</div>
    <div class="menu-container">
        <div class="menu-btn primary" onclick="showDeck()">CPU„Éê„Éà„É´</div>
        <div class="menu-btn" onclick="showLib()">„Ç´„Éº„ÉâÂõ≥Èëë</div>
        <div class="menu-btn disabled">ÂØæ‰∫∫Êà¶ (Ê∫ñÂÇô‰∏≠)</div>
    </div>
</div>

<div id="deck-screen" class="screen hidden scrollable">
    <h2 style="text-align:center; color:var(--accent)">„Éá„ÉÉ„Ç≠ÈÅ∏Êäû</h2>
    <div class="grid-container" id="d-grid"></div>
    <div class="back-btn" onclick="showTitle()">Êàª„Çã</div>
</div>

<div id="lib-screen" class="screen hidden scrollable">
    <h2 style="text-align:center; color:var(--primary)">„Ç´„Éº„ÉâÂõ≥Èëë</h2>
    <div class="grid-container" id="lib-grid" style="display:flex; flex-wrap:wrap; justify-content:center;"></div>
    <div class="back-btn" onclick="showTitle()">Êàª„Çã</div>
</div>

<div id="game-board">
    <div id="enemy-hand-area" class="area"></div>
    <div id="enemy-field" class="area"></div>
    <div id="info-area">
        <div class="leader" onclick="atkLdr('enemy')">
            <div style="font-size:20px;">ü§ñ</div><div id="enemy-hp" class="hp-circle">25</div>
        </div>
        <div style="text-align:center">
            <div id="turn-disp" style="color:#aaa; font-size: 10px;">Turn 1</div>
            <div id="mp-disp" style="font-size:14px;font-weight:bold;color:var(--success)">MP 1/1</div>
        </div>
        <button id="btn-end-turn" onclick="endTurn()">ÁµÇ‰∫Ü</button>
        <div class="leader" onclick="atkLdr('player')">
            <div id="player-hp" class="hp-circle">25</div><div style="font-size:20px;">üßë‚Äçüî¨</div>
        </div>
    </div>
    <div id="craft-list"></div>
    <div id="player-field" class="area"></div>
    <div id="player-hand-area"></div>
    <div id="cancel-btn" onclick="cancelAtk()">‚ùå „Ç≠„É£„É≥„Çª„É´</div>
</div>

<div class="action-overlay" id="action-btns" style="display:none;">
    <button class="game-btn btn-draw" onclick="actDraw()">Ôºã „Éâ„É≠„Éº</button>
    <button class="game-btn btn-syn" onclick="actSyn()">‚öóÔ∏è ÂêàÊàê</button>
</div>

<div id="det-pan" onclick="this.style.display='none'">
    <div style="text-align:right;font-size:24px">√ó</div>
    <div style="text-align:center">
        <span id="dt-sym" style="font-size:32px;font-weight:bold;color:var(--primary)"></span>
        <span id="dt-name" style="font-size:20px;font-weight:bold;margin-left:10px"></span>
    </div>
    <div class="big-art-frame art-frame"><div id="dt-art" class="css-art"></div></div>
    <div id="dt-st" style="display:flex;justify-content:center;gap:20px;font-size:18px;font-weight:bold;margin:10px 0;"></div>
    <div id="dt-desc" style="font-size:12px;color:#ccc;max-height:100px;overflow-y:auto;line-height:1.4;"></div>
    <div style="text-align:center;margin-top:10px;font-size:10px;color:#666">(„Çø„ÉÉ„Éó„Åó„Å¶Èñâ„Åò„Çã)</div>
</div>

<div id="skill-modal">
    <h3>ÊäÄ„ÇíÈÅ∏Êäû</h3>
    <div id="sk-list" style="width:100%; max-width:300px; display:flex; flex-direction:column; gap:10px;"></div>
    <button class="game-btn" style="background:#7f8c8d; margin-top:20px;" onclick="closeSk()">„Ç≠„É£„É≥„Çª„É´</button>
</div>

<div id="res-scr">
    <div class="res-tit" id="res-tit">VICTORY</div>
    <div style="margin-bottom:30px;font-size:20px;font-weight:bold;" id="res-msg">ÂãùÂà©ÔºÅ</div>
    <div class="menu-btn" onclick="showTitle()">„Çø„Ç§„Éà„É´„Å∏</div>
</div>

<div id="msg-box"></div>
<script>
// „Éá„Éº„ÇøÂÆöÁæ©
const MAX_H=10, MAX_F=5, INI_HP=25;

const ELEM = {
    H:{s:'H',n:'Ê∞¥Á¥†',r:'N',c:'art-p-fire'}, He:{s:'He',n:'„Éò„É™„Ç¶„É†',r:'SR',c:'art-p-gas'}, Li:{s:'Li',n:'„É™„ÉÅ„Ç¶„É†',r:'R',c:'art-p-metal'},
    B:{s:'B',n:'„Éõ„Ç¶Á¥†',r:'R',c:'art-p-solid'}, C:{s:'C',n:'ÁÇ≠Á¥†',r:'N',c:'art-p-solid'}, N:{s:'N',n:'Á™íÁ¥†',r:'N',c:'art-p-gas'},
    O:{s:'O',n:'ÈÖ∏Á¥†',r:'N',c:'art-p-gas'}, F:{s:'F',n:'„Éï„ÉÉÁ¥†',r:'SR',c:'art-p-toxic'}, Ne:{s:'Ne',n:'„Éç„Ç™„É≥',r:'SR',c:'art-p-gas'},
    Na:{s:'Na',n:'„Éä„Éà„É™„Ç¶„É†',r:'N',c:'art-p-metal'}, Mg:{s:'Mg',n:'„Éû„Ç∞„Éç„Ç∑„Ç¶„É†',r:'R',c:'art-p-metal'}, Al:{s:'Al',n:'„Ç¢„É´„Éü„Éã„Ç¶„É†',r:'R',c:'art-p-metal'},
    Si:{s:'Si',n:'„Ç±„Ç§Á¥†',r:'R',c:'art-p-solid'}, P:{s:'P',n:'„É™„É≥',r:'R',c:'art-p-solid'}, S:{s:'S',n:'Á°´ÈªÑ',r:'R',c:'art-p-toxic'},
    Cl:{s:'Cl',n:'Â°©Á¥†',r:'N',c:'art-p-toxic'}, Ar:{s:'Ar',n:'„Ç¢„É´„Ç¥„É≥',r:'SR',c:'art-p-gas'}, K:{s:'K',n:'„Ç´„É™„Ç¶„É†',r:'N',c:'art-p-metal'},
    Ca:{s:'Ca',n:'„Ç´„É´„Ç∑„Ç¶„É†',r:'R',c:'art-p-metal'}, Ti:{s:'Ti',n:'„ÉÅ„Çø„É≥',r:'SR',c:'art-p-metal'}, V:{s:'V',n:'„Éê„Éä„Ç∏„Ç¶„É†',r:'SR',c:'art-p-metal'},
    Cr:{s:'Cr',n:'„ÇØ„É≠„É†',r:'SR',c:'art-p-metal'}, Mn:{s:'Mn',n:'„Éû„É≥„Ç¨„É≥',r:'R',c:'art-p-metal'}, Fe:{s:'Fe',n:'ÈâÑ',r:'N',c:'art-p-metal'},
    Ni:{s:'Ni',n:'„Éã„ÉÉ„Ç±„É´',r:'R',c:'art-p-metal'}, Cu:{s:'Cu',n:'ÈäÖ',r:'N',c:'art-p-metal'}, Zn:{s:'Zn',n:'‰∫úÈâõ',r:'R',c:'art-p-metal'},
    Ga:{s:'Ga',n:'„Ç¨„É™„Ç¶„É†',r:'SR',c:'art-p-metal'}, Ge:{s:'Ge',n:'„Ç≤„É´„Éû„Éã„Ç¶„É†',r:'SR',c:'art-p-metal'}, Ag:{s:'Ag',n:'ÈäÄ',r:'SR',c:'art-p-metal'},
    Cd:{s:'Cd',n:'„Ç´„Éâ„Éü„Ç¶„É†',r:'R',c:'art-p-toxic'}, Sn:{s:'Sn',n:'„Çπ„Ç∫',r:'R',c:'art-p-metal'}, Ba:{s:'Ba',n:'„Éê„É™„Ç¶„É†',r:'R',c:'art-p-metal'},
    W:{s:'W',n:'„Çø„É≥„Ç∞„Çπ„ÉÜ„É≥',r:'SSR',c:'art-p-metal'}, Pt:{s:'Pt',n:'„Éó„É©„ÉÅ„Éä',r:'SSR',c:'art-p-metal'}, Au:{s:'Au',n:'Èáë',r:'SSR',c:'art-p-gold'},
    Hg:{s:'Hg',n:'Ê∞¥ÈäÄ',r:'SR',c:'art-p-liquid'}, Pb:{s:'Pb',n:'Èâõ',r:'R',c:'art-p-metal'}
};

const REC = [
    {i:['H','Cl'],p:{s:'HCl',n:'Â°©ÂåñÊ∞¥Á¥†',r:'R',a:5,h:1,c:'art-p-toxic',sk:[{n:'Âº∑ÈÖ∏',p:5,d:'È´òÁÅ´Âäõ'}]}},
    {i:['H','F'],p:{s:'HF',n:'„Éï„ÉÉÂåñÊ∞¥Á¥†',r:'SR',a:4,h:2,ab:'tox',c:'art-p-toxic',sk:[{n:'„Ç¨„É©„ÇπËÖêÈ£ü',p:4,d:'ÊîªÊíÉ'},{n:'ÁåõÊØí',p:0,t:'tox',d:'ÂøÖÊÆ∫'}]}},
    {i:['Na','H'],p:{s:'NaH',n:'Ê∞¥Á¥†ÂåñNa',r:'R',a:3,h:1,ab:'stm',c:'art-p-solid',sk:[{n:'ÈÇÑÂÖÉ',p:3,d:'ÁñæËµ∞'}]}},
    {i:['H','H','O'],p:{s:'H2O',n:'Ê∞¥',r:'N',a:1,h:4,c:'art-p-liquid',sk:[{n:'Ê∞¥ÊµÅ',p:1,d:'ÊîªÊíÉ'},{n:'Âä†Ê∞¥ÂàÜËß£',p:3,t:'heal',d:'ÂõûÂæ©'}]}},
    {i:['Ag','Cl'],p:{s:'AgCl',n:'Â°©ÂåñÈäÄ',r:'SR',a:1,h:6,ab:'wrd',c:'art-p-solid',sk:[{n:'Ê≤àÊÆø',p:0,t:'grd',d:'ÂÆàË≠∑'}]}},
    {i:['Fe','O'],p:{s:'FeO',n:'ÈÖ∏ÂåñÈâÑ',r:'N',a:3,h:5,c:'art-p-solid',sk:[{n:'ÈªíÈåÜ',p:3,d:'ÈÄöÂ∏∏'}]}},
    {i:['Fe','O','O'],p:{s:'Fe2O3',n:'Ëµ§ÈåÜ',r:'R',a:2,h:8,ab:'wrd',c:'art-p-solid',sk:[{n:'‰∏çÂãïÊÖã',p:2,d:'È´òËÄê‰πÖ'}]}},
    {i:['Cu','O'],p:{s:'CuO',n:'ÈÖ∏ÂåñÈäÖ',r:'N',a:3,h:4,c:'art-p-solid',sk:[{n:'ÈªíÁ≤â',p:3,d:'ÊîªÊíÉ'}]}},
    {i:['Zn','Cu'],p:{s:'Brass',n:'ÈªÑÈäÖ',r:'R',a:4,h:5,c:'art-p-metal',sk:[{n:'ÂêàÈáë',p:4,d:'ÊîªÊíÉ'}]}},
    {i:['Hg','Zn'],p:{s:'Amalgam',n:'„Ç¢„Éû„É´„Ç¨„É†',r:'SR',a:3,h:6,ab:'wrd',c:'art-p-metal',sk:[{n:'ÂêàÈáëÂåñ',p:3,d:'ÂÆàË≠∑'}]}},
    {i:['C','O'],p:{s:'CO',n:'‰∏ÄÈÖ∏ÂåñÁÇ≠Á¥†',r:'R',a:1,h:2,ab:'tox',c:'art-p-gas',sk:[{n:'‰∏çÂÆåÂÖ®ÁáÉÁÑº',p:1,d:'ÊîªÊíÉ'},{n:'ÁµêÂêà',p:0,t:'tox',d:'ÂøÖÊÆ∫'}]}},
    {i:['H','S'],p:{s:'H2S',n:'Á°´ÂåñÊ∞¥Á¥†',r:'R',a:2,h:3,ab:'tox',c:'art-p-gas',sk:[{n:'ËÖêÂçµËá≠',p:2,d:'ÊîªÊíÉ'},{n:'Á°´Âåñ',p:0,t:'tox',d:'ÂøÖÊÆ∫'}]}},
    {i:['Cl','Cl'],p:{s:'Cl2',n:'Â°©Á¥†„Ç¨„Çπ',r:'R',a:3,h:3,c:'art-p-gas',sk:[{n:'Êï£Â∏É',p:2,t:'aoe',d:'ÂÖ®‰Ωì2„ÉÄ„É°'}]}},
    {i:['S','O','O'],p:{s:'SO2',n:'‰∫åÈÖ∏ÂåñÁ°´ÈªÑ',r:'N',a:2,h:4,c:'art-p-gas',sk:[{n:'ÈÖ∏ÊÄßÈõ®',p:1,t:'aoe',d:'ÂÖ®‰Ωì1„ÉÄ„É°'}]}},
    {i:['Cd','S'],p:{s:'CdS',n:'Á°´ÂåñCd',r:'SR',a:2,h:5,ab:'tox',c:'art-p-toxic',sk:[{n:'ÁåõÊØí',p:0,t:'tox',d:'ÁåõÊØí'}]}},
    {i:['Na','O','H'],p:{s:'NaOH',n:'Ê∞¥ÈÖ∏ÂåñNa',r:'R',a:3,h:3,c:'art-p-solid',sk:[{n:'‰∏≠ÂíåÁÜ±',p:2,t:'ah',d:'ÂÖ®‰Ωì2„ÉÄ„É°/ÂõûÂæ©'}]}},
    {i:['Al','O','O'],p:{s:'Al2O3',n:'„Ç¢„É´„Éü„Éä',r:'R',a:2,h:7,ab:'wrd',c:'art-p-solid',sk:[{n:'Ë¢´ËÜú',p:2,d:'ÂÆàË≠∑'}]}},
    {i:['Cl','Na'],p:{s:'NaCl',n:'Â°©ÂåñNa',r:'N',a:3,h:4,c:'art-p-solid',sk:[{n:'Â°©Âë≥',p:3,d:'ÈÄöÂ∏∏'}]}},
    {i:['Ca','O','H','H'],p:{s:'Ca(OH)2',n:'Ê∂àÁü≥ÁÅ∞',r:'N',a:1,h:6,ab:'wrd',c:'art-p-solid',sk:[{n:'‰∏≠Âíå',p:4,t:'heal',d:'ÂõûÂæ©'}]}},
    {i:['C','C','C'],p:{s:'Diamond',n:'„ÉÄ„Ç§„É§',r:'SSR',a:4,h:10,ab:'wrd',c:'art-p-gold',sk:[{n:'Á°¨Â∫¶10',p:4,d:'ÈâÑÂ£Å'}]}},
    {i:['Al','O','O','Cr'],p:{s:'Ruby',n:'„É´„Éì„Éº',r:'SR',a:5,h:8,c:'art-p-solid',sk:[{n:'Ê∑±Á¥Ö',p:5,d:'ÊîªÊíÉ'}]}},
    {i:['Al','O','Ti'],p:{s:'Sapphire',n:'„Çµ„Éï„Ç°„Ç§„Ç¢',r:'SR',a:4,h:9,c:'art-p-solid',sk:[{n:'ÈùíÁéâ',p:4,d:'ÊîªÊíÉ'}]}},
    {i:['Si','O','O'],p:{s:'SiO2',n:'Áü≥Ëã±',r:'N',a:3,h:6,c:'art-p-solid',sk:[{n:'ÁµêÊô∂',p:2,t:'aoe',d:'ÂÖ®‰Ωì2„ÉÄ„É°'}]}},
    {i:['Au'],p:{s:'Au',n:'Èáë',r:'SSR',a:6,h:6,c:'art-p-gold',sk:[{n:'Ëºù„Åç',p:6,d:'È´òÁÅ´Âäõ'}]}},
    {i:['Pt'],p:{s:'Pt',n:'„Éó„É©„ÉÅ„Éä',r:'SSR',a:5,h:7,c:'art-p-metal',sk:[{n:'Ëß¶Â™í',p:5,d:'ÊîªÊíÉ'}]}},
    {i:['W'],p:{s:'W',n:'„Çø„É≥„Ç∞„Çπ„ÉÜ„É≥',r:'SSR',a:7,h:8,ab:'wrd',c:'art-p-metal',sk:[{n:'ËûçÁÇπ',p:7,d:'ÊîªÊíÉ'}]}},
    {i:['Ti'],p:{s:'Ti',n:'„ÉÅ„Çø„É≥',r:'SR',a:4,h:5,c:'art-p-metal',sk:[{n:'Âº∑Â∫¶',p:4,d:'ÊîªÊíÉ'}]}},
    {i:['He','He'],p:{s:'He',n:'„Éò„É™„Ç¶„É†',r:'SR',a:2,h:2,ab:'stl',c:'art-p-gas',sk:[{n:'‰∏çÊ¥ªÊÄß',p:2,d:'ÊΩú‰ºè'}]}},
    {i:['Ne','Ne'],p:{s:'Ne',n:'„Éç„Ç™„É≥',r:'SR',a:3,h:3,ab:'stl',c:'art-p-gas',sk:[{n:'Áô∫ÂÖâ',p:3,d:'ÊΩú‰ºè'}]}},
    {i:['Ar','Ar'],p:{s:'Ar',n:'„Ç¢„É´„Ç¥„É≥',r:'SR',a:4,h:4,ab:'stl',c:'art-p-gas',sk:[{n:'‰øùË≠∑',p:4,d:'ÊΩú‰ºè'}]}},
    {i:['H','Cl','N','O','O','O'],p:{s:'AquaRegia',n:'ÁéãÊ∞¥',r:'SSR',a:0,h:0,tp:'spl',c:'art-p-liquid',sk:[{n:'Ê∫∂Ëß£',p:99,t:'tox',d:'Èô§Âéª'}]}},
    {i:['H','H','S','O','O','O','O'],p:{s:'H2SO4',n:'ÊøÉÁ°´ÈÖ∏',r:'SR',a:0,h:0,tp:'spl',c:'art-p-liquid',sk:[{n:'ËÑ±Ê∞¥',p:5,t:'aoe',d:'ÂÖ®‰Ωì5„ÉÄ„É°'}]}},
    {i:['K','Mn','O','O','O','O'],p:{s:'KMnO4',n:'ÈÅé„Éû„É≥„Ç¨„É≥ÈÖ∏K',r:'SR',a:0,h:0,tp:'spl',c:'art-p-solid',sk:[{n:'ÈÖ∏Âåñ',p:7,t:'dmg',d:'7„ÉÄ„É°'}]}}
];

const DECKS = {
    aggro:{n:'Ë∂ÖÈÄüÊîª',d:'È´òÁÅ´Âäõ„Éª‰ΩéËÄê‰πÖ',e:['H','H','Cl','F','Na','O'],r:['HCl','HF','NaH','H2O']},
    counter:{n:'„Ç´„Ç¶„É≥„Çø„Éº',d:'ÂÆà„Å£„Å¶ÂèçÊíÉ',e:['Ag','Cl','Fe','O','Cu','Zn','Hg'],r:['AgCl','FeO','Fe2O3','Brass','Amalgam','CuO']},
    toxic:{n:'ÂÆ≥ÊÇ™',d:'ÂøÖÊÆ∫„ÅßÂç≥Ê≠ª',e:['C','O','S','H','Cl','Cd'],r:['CO','H2S','Cl2','SO2','CdS']},
    control:{n:'„Ç≥„É≥„Éà„É≠„Éº„É´',d:'ÂõûÂæ©„Å®ÊîØÈÖç',e:['Al','O','H','Na','Cl','Ca'],r:['Al2O3','NaOH','H2O','NaCl','Ca(OH)2']},
    gemstone:{n:'ÂÆùÁü≥',d:'ÊúÄÂº∑„ÅÆÁ°¨Â∫¶',e:['C','C','C','Al','O','Si','Cr','Ti'],r:['Diamond','Ruby','Sapphire','SiO2']},
    heavy:{n:'ÈáçÈáëÂ±û',d:'ÂæåÂçäÊúÄÂº∑',e:['Au','Pt','W','Ti'],r:['Au','Pt','W','Ti']},
    noble:{n:'Ë≤¥„Ç¨„Çπ',d:'ÊΩú‰ºèÊîªÊíÉ',e:['He','He','Ne','Ne','Ar','Ar'],r:['He','Ne','Ar']},
    hazard:{n:'Âç±Èô∫Áâ©',d:'Èô§Âéª„Çπ„Éö„É´',e:['H','Cl','N','O','S','K','Mn'],r:['AquaRegia','H2SO4','KMnO4']}
};

let gs={hp:25,ehp:25,h:[],f:[],eh:[],ef:[],tn:1,mp:1,mmp:1,my:true,sel:[],atk:null};

window.onload=()=>{
    initParticles();
    const g=document.getElementById('d-grid');
    for(let k in DECKS){
        const d=document.createElement('div'); d.className='list-card';
        d.innerHTML=`<div class="deck-title">${DECKS[k].n}</div><div class="deck-desc">${DECKS[k].d}</div>`;
        d.onclick=()=>startGame(k); g.appendChild(d);
    }
    const lg=document.getElementById('lib-grid');
    for(let k in ELEM) addLib(ELEM[k],true,lg);
    REC.forEach(r=>addLib(r.p,false,lg));
    showTitle();
};

function initParticles(){
    const c=document.getElementById('particles'); if(!c)return;
    for(let i=0;i<30;i++){const p=document.createElement('div');p.className='particle';p.style.left=Math.random()*100+'vw';p.style.width=p.style.height=(Math.random()*5+2)+'px';p.style.animationDuration=(Math.random()*10+5)+'s';p.style.animationDelay=(Math.random()*5)+'s';c.appendChild(p);}
}

function addLib(d,isE,rt){
    const c=createC({...d,id:0},isE,false,false,false);
    c.onclick=()=>showDet(d,isE);
    rt.appendChild(c);
}

function showTitle(){hide();document.getElementById('title-screen').classList.remove('hidden');}
function showDeck(){hide();document.getElementById('deck-select-screen').classList.remove('hidden');}
function showLib(){hide();document.getElementById('lib-screen').classList.remove('hidden');}
function hide(){document.querySelectorAll('.screen').forEach(e=>e.classList.add('hidden'));document.getElementById('game-board').style.display='none';document.getElementById('acts').style.display='none';document.getElementById('res-scr').style.display='none';}

function startGame(k){
    gs={hp:25,ehp:25,h:[],f:[],eh:[],ef:[],tn:1,mp:1,mmp:1,my:true,sel:[],atk:null};
    gs.pp=DECKS[k].e.map(x=>ELEM[x]); gs.pr=REC.filter(r=>DECKS[k].r.includes(r.p.s));
    let ek=Object.keys(DECKS)[Math.floor(Math.random()*8)];
    gs.ep=DECKS[ek].e.map(x=>ELEM[x]); gs.er=REC.filter(r=>DECKS[ek].r.includes(r.p.s));
    document.getElementById('enemy-name').innerText=`CPU (${DECKS[ek].n.substring(0,4)})`;
    hide(); document.getElementById('game-board').style.display='flex'; document.getElementById('acts').style.display='flex';
    for(let i=0;i<5;i++){draw(true);draw(false);}
    upd(); msg("„Éê„Éà„É´ÈñãÂßãÔºÅ");
}

function draw(isP){
    const p=isP?gs.pp:gs.ep, h=isP?gs.h:gs.eh;
    if(h.length>=10){ if(!isP)h.shift(); else return; }
    h.push({...p[Math.floor(Math.random()*p.length)], id:Math.random().toString(36), type:'el'});
}

function actDraw(){ if(!gs.my||gs.mp<1){msg("MP‰∏çË∂≥");return;} gs.mp--; draw(true); upd(); }

function actSyn(){
    if(!gs.my||gs.sel.length<1)return;
    const sl=gs.h.filter(c=>gs.sel.includes(c.id)), sym=sl.map(c=>c.s).sort();
    if(gs.sel.length===1){
        const r=gs.pr.find(x=>x.i.length===1 && x.i[0]===sym[0]);
        if(r){ doSyn(r); return; }
    }
    const r=gs.pr.find(x=>JSON.stringify(x.i.sort())===JSON.stringify(sym));
    if(r) doSyn(r); else {msg("ÂèçÂøú„Å™„Åó");gs.sel=[];upd();}
}

function doSyn(r){
    if(r.p.tp==='spl'){
        gs.h=gs.h.filter(c=>!gs.sel.includes(c.id)); gs.sel=[];
        const s=r.p.sk[0];
        if(gs.ef.length>0){ const t=gs.ef.reduce((a,b)=>a.cur>b.cur?a:b); if(s.t==='tox')t.cur=-99;else t.cur-=s.p; msg(`${s.n}->${t.n}`); }
        else{ gs.ehp-=s.p; msg(`${s.n}->Leader`); }
        chk(); upd(); return;
    }
    if(gs.f.length>=5){msg("Ê∫ÄÂì°");return;}
    gs.h=gs.h.filter(c=>!gs.sel.includes(c.id)); gs.sel=[];
    gs.f.push({...r.p,id:Math.random().toString(36),max:r.p.h,cur:r.p.h,can:r.p.ab==='stm',type:'unit'});
    msg(`Âè¨Âñö:${r.p.n}`); upd();
}

function onHand(id){ if(!gs.my)return; const c=gs.h.find(x=>x.id===id); showDet(c,true); if(gs.sel.includes(id))gs.sel=gs.sel.filter(x=>x!==id);else gs.sel.push(id); upd(); }
function onField(id,isP){
    if(!gs.my)return;
    if(isP){
        const u=gs.f.find(x=>x.id===id); showDet(u,false);
        if(u&&u.can){gs.atk=u;document.body.classList.add('targeting');upd();}
    } else if(gs.atk){
        const t=gs.ef.find(x=>x.id===id); if(t.ab==='stl'){msg("ÊΩú‰ºè‰∏≠");return;}
        prepAtk(gs.atk,t,'unit');
    } else {
        showDet(gs.ef.find(x=>x.id===id),false);
    }
}
function atkLdr(s){ if(s==='enemy'&&gs.atk) prepAtk(gs.atk,'ldr','ldr'); }

function prepAtk(a,t,type){
    if(type==='ldr'||(type==='unit'&&t.ab!=='wrd')){
        if(gs.ef.some(u=>u.ab==='wrd'&&u.ab!=='stl')){msg("ÂÆàË≠∑„ÅÇ„Çä");cancelAtk();return;}
    }
    if(a.sk.length>1) openSk(a,t); else exeSk(a,t,a.sk[0]);
}

function openSk(a,t){
    const m=document.getElementById('skill-modal'), l=document.getElementById('sk-list'); l.innerHTML='';
    a.sk.forEach(s=>{
        const b=document.createElement('div'); b.className='sk-btn'; b.innerHTML=`${s.n} (${s.p})`;
        b.onclick=()=>{exeSk(a,t,s);m.style.display='none';}; l.appendChild(b);
    });
    m.style.display='flex';
}
function closeSk(){document.getElementById('skill-modal').style.display='none';cancelAtk();}

function exeSk(a,t,s){
    if(s.t==='aoe'){gs.ef.forEach(u=>u.cur-=s.p);gs.ehp-=s.p;}
    else if(s.t==='ah'){gs.ef.forEach(u=>u.cur-=s.p);gs.hp+=s.p;}
    else if(s.t==='heal'){gs.hp+=s.p;}
    else{
        let d=s.p; if(t==='ldr')gs.ehp-=d;
        else{
            let cnt=t.a; if(s.t==='tox'&&d>0)t.cur=-99;else t.cur-=d;
            if(t.cur<=0&&t.ab==='tox'&&cnt>0)a.cur=-99;else a.cur-=cnt;
        }
    }
    a.can=false; msg(s.n); cancelAtk(); chk(); upd();
}

function cancelAtk(){gs.atk=null;document.body.classList.remove('targeting');upd();}
function chk(){
    gs.f=gs.f.filter(u=>u.cur>0); gs.ef=gs.ef.filter(u=>u.cur>0);
    if(gs.ehp<=0)res(true); else if(gs.hp<=0)res(false);
}
function res(w){
    const s=document.getElementById('res-scr'), t=document.getElementById('res-tit'), m=document.getElementById('res-msg');
    s.style.display='flex';
    if(w){t.innerText="VICTORY";t.className="res-tit res-win";m.innerText="ÂãùÂà©ÔºÅ";confetti();}
    else{t.innerText="DEFEAT";t.className="res-tit res-lose";m.innerText="ÊïóÂåó...";}
}
function endTurn(){ gs.my=false;cancelAtk();upd();msg("Êïµ„Çø„Éº„É≥");setTimeout(cpu,1000); }

async function cpu(){
    if(gs.mmp<10)gs.mmp++; gs.mp=gs.mmp; draw(false); upd(); await sleep(500);
    let act=true; while(act&&gs.ef.length<5){ act=false; const h=gs.eh.map(c=>c.s);
        for(let r of gs.er){
            if(r.p.tp==='spl')continue;
            let i=[...r.i], th=[...h], ok=true;
            for(let x of i){ let idx=th.indexOf(x); if(idx<0){ok=false;break;} th.splice(idx,1); }
            if(ok){
                for(let x of r.i){ let idx=gs.eh.findIndex(c=>c.s===x); gs.eh.splice(idx,1); }
                gs.ef.push({...r.p,id:Math.random(),max:r.p.h,cur:r.p.h,can:false,type:'unit'});
                msg("CPUÂè¨Âñö"); upd(); await sleep(800); act=true; break;
            }
        }
    }
    gs.ef.forEach(u=>u.can=true);
    for(let u of gs.ef){
        if(!u.can)continue;
        let t='ldr', grd=gs.f.find(g=>g.ab==='wrd'&&g.ab!=='stl'); if(grd)t=grd;
        if(t==='ldr') gs.hp-=u.sk[0].p;
        else { let d=u.sk[0].p; if(u.sk[0].t==='tox'&&d>0)t.cur=-99;else t.cur-=d; u.cur-=t.a; }
        chk(); upd(); await sleep(800);
    }
    gs.tn++; gs.my=true; gs.f.forEach(u=>u.can=true); draw(true); msg("Ëá™„Çø„Éº„É≥"); upd();
}
const sleep=m=>new Promise(r=>setTimeout(r,m));

function upd(){
    document.getElementById('turn-disp').innerText=`Turn ${gs.tn}`; document.getElementById('mp-disp').innerText=`MP ${gs.mp}/${gs.mmp}`;
    document.getElementById('p-hp').innerText=gs.hp; document.getElementById('enemy-hp').innerText=gs.ehp;
    document.getElementById('cancel-attack-btn').style.display=gs.atk?'block':'none';
    rend('player-hand-area', gs.h, 'h', true); rend('player-field', gs.f, 'f', true); rend('enemy-field', gs.ef, 'f', false);
    const eh=document.getElementById('enemy-hand-area'); eh.innerHTML=''; gs.eh.forEach(()=>{const d=document.createElement('div');d.className='card';d.style.background='#34495e';d.style.width='30px';d.style.height='45px';eh.appendChild(d);});
    const hl=document.getElementById('craftable-list'); hl.innerHTML='';
    if(gs.my) gs.pr.forEach(r=>{
        let h=gs.h.map(c=>c.s), ok=true;
        for(let x of r.i){ let idx=h.indexOf(x); if(idx<0){ok=false;break;} h.splice(idx,1); }
        if(ok){
            const b=document.createElement('div'); b.className='craft-hint-btn';
            b.innerHTML=`<div style="font-weight:bold;color:var(--accent)">‚ú® ${r.p.n}</div><div style="font-size:10px">‚öîÔ∏è${r.p.a} ‚ù§Ô∏è${r.p.h}</div>`;
            b.onclick=()=>{ gs.sel=[]; let th=[...gs.h]; r.i.forEach(x=>{ let idx=th.findIndex(c=>c.s===x); gs.sel.push(th[idx].id); th.splice(idx,1); }); upd(); };
            hl.appendChild(b);
        }
    });
}

function rend(eid, l, type, isP){
    const el=document.getElementById(eid); el.innerHTML='';
    l.forEach(c=>{ el.appendChild(createC(c, c.type==='el', type==='h'&&gs.sel.includes(c.id), type==='f'&&c.can&&isP, type==='f'&&!isP&&gs.atk)); });
}

function createC(c, isEl, isSel, isCan, isTgt){
    const d=document.createElement('div'); d.className='card'; d.setAttribute('data-rarity', c.r);
    let art=c.c||'art-p-solid', bz='', st='';
    if(!isEl){
        if(c.ab==='wrd')bz+='<div class="c-badge cb-ward">üõ°Ô∏è</div>'; if(c.ab==='tox')bz+='<div class="c-badge cb-toxic">‚ò†Ô∏è</div>';
        if(c.ab==='stm')bz+='<div class="c-badge cb-storm">‚ö°</div>'; if(c.ab==='stl')bz+='<div class="c-badge cb-stealth">üëÅÔ∏è</div>';
        st=`<div class="c-stats-box"><div class="st-val stat-atk-box">‚öîÔ∏è${c.a}</div><div class="st-val stat-hp-box">‚ù§Ô∏è${c.cur}</div></div>`;
    }
    d.innerHTML=`
        <div class="c-head"><span>${c.n}</span><span style="color:var(--primary)">${c.s}</span></div>
        <div class="c-art-box"><div class="css-art ${art}"></div></div>
        <div class="c-text-box">${!isEl&&c.sk?`<span class="skill-name-small">${c.sk[0].n}</span>`:(isEl?'Á¥†Êùê':'')}</div>
        ${!isEl?`<div class="badges" style="flex-direction:column">${bz}</div>`:''}
        ${st}
    `;
    if(isSel)d.classList.add('selected'); if(isCan)d.classList.add('can-attack'); if(isTgt)d.classList.add('valid-target');
    if(!d.onclick) d.onclick=(e)=>{e.stopPropagation(); if(gs.h.includes(c)) onHand(c.id); else if(gs.f.includes(c)) onField(c.id,true); else if(gs.ef.includes(c)) onField(c.id,false); };
    return d;
}

function showDet(c, isEl){
    const p=document.getElementById('card-detail-panel'); p.style.display='flex';
    document.getElementById('detail-symbol').innerText=c.s; document.getElementById('detail-name').innerText=c.n; document.getElementById('detail-rarity').innerText=c.r;
    document.getElementById('detail-css-art').className=`css-art ${c.c||'art-p-solid'}`;
    const st=document.getElementById('detail-stats'), ds=document.getElementById('detail-skills');
    if(isEl){ st.innerHTML=`<span style="font-size:14px;color:#ccc">Á¥†Êùê</span>`; ds.innerHTML=`<div>ÂêàÊàê„Å´‰ΩøÁî®„Åó„Åæ„Åô„ÄÇ</div>`; }
    else{
        st.innerHTML=`<span style="color:#e67e22">‚öîÔ∏è${c.a}</span> <span style="color:#2ecc71">‚ù§Ô∏è${c.cur}/${c.max}</span>`;
        ds.innerHTML=c.sk.map(s=>`<div><b>${s.n}</b> (${s.p}): ${s.d}</div>`).join('');
    }
}
function msg(t){const b=document.getElementById('msg-box');b.innerText=t;b.style.opacity=1;setTimeout(()=>b.style.opacity=0,1500);}
function createConfetti(){ const c=document.getElementById('confetti-container'); if(!c)return; c.innerHTML=''; for(let i=0;i<50;i++){ const p=document.createElement('div'); p.className='confetti'; p.style.left=Math.random()*100+'vw'; p.style.backgroundColor=`hsl(${Math.random()*360},100%,50%)`; p.style.animationDuration=(Math.random()*3+2)+'s'; c.appendChild(p); } }
</script>
</body>
</html>