<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Chem-Verse: CSS Art</title>
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700;800&family=Orbitron:wght@700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #1a1a1d;
            --accent: #f1c40f;
            --primary: #3498db;
            --danger: #e74c3c;
            --success: #2ecc71;
            /* „É¨„Ç¢„É™„ÉÜ„Ç£Ëâ≤ */
            --rare-n: #95a5a6;
            --rare-r: #3498db;
            --rare-sr: #9b59b6;
            --rare-ssr: #f1c40f;
        }

        body {
            font-family: 'M PLUS Rounded 1c', sans-serif;
            background-color: var(--bg-color);
            color: white;
            margin: 0;
            user-select: none;
            overflow: hidden;
            -webkit-tap-highlight-color: transparent;
            height: 100vh;
            width: 100vw;
        }

        /* --- CSS ART („Éó„É≠„Ç∞„É©„É†„ÅßÁµµ„ÇíÊèè„Åè) --- */
        .css-art {
            width: 100%; height: 100%; position: relative;
            display: flex; justify-content: center; align-items: center;
            overflow: hidden;
        }
        
        /* Ê∞¥Á¥† (H): „Åµ„Çè„Åµ„ÇèÈõ≤ */
        .art-H { background: linear-gradient(to top, #89f7fe, #66a6ff); }
        .art-H::after {
            content: '( ‚Ä¢œâ‚Ä¢ )'; font-size: 14px; color: #555;
            position: absolute; width: 40px; height: 30px;
            background: white; border-radius: 50%;
            box-shadow: 10px 5px 0 white, -10px 5px 0 white;
            display: flex; justify-content: center; align-items: center;
            padding-top: 5px;
        }

        /* Â°©Á¥† (Cl): ÊØí„Ç¨„Çπ„ÅäÂåñ„Åë */
        .art-Cl { background: linear-gradient(to top, #d4fc79, #96e6a1); }
        .art-Cl::after {
            content: '‚ò†Ô∏è'; font-size: 24px;
            filter: drop-shadow(0 0 5px green);
            animation: float 2s infinite ease-in-out;
        }

        /* Èáë (Au): „Ç≠„É©„Ç≠„É©Âª∂„ÅπÊ£í */
        .art-Au { background: radial-gradient(circle, #ffd700, #b8860b); }
        .art-Au::after {
            content: '‚ú®'; font-size: 30px;
            text-shadow: 0 0 10px gold;
        }

        /* ÈÖ∏Á¥† (O): ÈÄèÊòé„Å™Ê≥° */
        .art-O { background: linear-gradient(to top, #a1c4fd, #c2e9fb); }
        .art-O::before {
            content: ''; position: absolute; width: 20px; height: 20px;
            border: 2px solid rgba(255,255,255,0.8); border-radius: 50%;
            top: 20%; left: 30%;
        }
        .art-O::after {
            content: ''; position: absolute; width: 10px; height: 10px;
            border: 2px solid rgba(255,255,255,0.6); border-radius: 50%;
            bottom: 30%; right: 30%;
        }

        /* Ê±éÁî®: ÈáëÂ±û */
        .art-metal-gen { background: linear-gradient(45deg, #bdc3c7, #2c3e50); }
        .art-metal-gen::after { content: '‚öôÔ∏è'; font-size: 24px; opacity: 0.7; }

        /* Ê±éÁî®: Ê∂≤‰Ωì */
        .art-liquid-gen { background: linear-gradient(to bottom, #4facfe, #00f2fe); }
        .art-liquid-gen::after { content: 'üíß'; font-size: 24px; }

        /* Ê±éÁî®: Âõ∫‰Ωì */
        .art-solid-gen { background: linear-gradient(to bottom, #e6b980, #eacda3); }
        .art-solid-gen::after { content: 'ü™®'; font-size: 24px; }

        /* Ê±éÁî®: ÊØí */
        .art-toxic-gen { background: linear-gradient(to bottom, #f093fb, #f5576c); }
        .art-toxic-gen::after { content: 'üòà'; font-size: 24px; }

        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }


        /* --- UI & LAYOUT (ÂâçÂõû„ÅÆ„Åæ„Åæ) --- */
        .screen { position: absolute; top:0; left:0; width:100%; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:center; background: #1a1a1d; z-index:100; transition:0.3s; }
        .hidden { display: none !important; opacity: 0; pointer-events: none; }
        
        #title-screen { background: radial-gradient(circle, #2c3e50, #000); }
        .game-logo { font-family:'Orbitron', sans-serif; font-size:36px; color:var(--accent); text-shadow:0 0 15px var(--accent); margin-bottom:10px; text-align:center;}
        .menu-btn { background:rgba(255,255,255,0.1); border:1px solid #aaa; color:white; padding:15px 40px; border-radius:30px; font-weight:bold; margin:10px; cursor:pointer; }
        
        #deck-select-screen { padding:20px; display:block; overflow-y:auto; }
        .deck-grid { display:grid; grid-template-columns:1fr 1fr; gap:10px; padding-bottom:50px; }
        .deck-card { background:rgba(255,255,255,0.1); border:1px solid #555; padding:15px; border-radius:10px; cursor:pointer; }
        .deck-title { color:var(--accent); font-weight:bold; margin-bottom:5px; }
        .deck-desc { font-size:10px; color:#ccc; }

        #game-board { display:none; flex-direction:column; height:100vh; background:#111; }
        #enemy-hand-area { height:10%; background:rgba(255,255,255,0.05); display:flex; justify-content:center; align-items:center; }
        #enemy-field { height:23%; border-bottom:1px solid #333; display:flex; justify-content:center; align-items:center; }
        #info-area { height:12%; background:#222; display:flex; justify-content:space-between; align-items:center; padding:0 10px; z-index:10; box-shadow:0 0 10px black; }
        #player-field { height:23%; border-top:1px solid #333; display:flex; justify-content:center; align-items:center; }
        #player-hand-area { height:32%; background:rgba(255,255,255,0.05); display:flex; align-items:center; overflow-x:auto; padding-left:10px; }

        /* „Ç´„Éº„Éâ */
        .card { 
            width:70px; height:100px; background:#222; border-radius:8px; 
            border:2px solid #555; margin:3px; position:relative; flex-shrink:0; 
            box-shadow:0 4px 8px rgba(0,0,0,0.5); overflow:hidden; transition:0.1s;
        }
        .card[data-rarity="N"] { border-color: var(--rare-n); }
        .card[data-rarity="R"] { border-color: var(--rare-r); box-shadow:0 0 5px var(--rare-r); }
        .card[data-rarity="SR"] { border-color: var(--rare-sr); box-shadow:0 0 8px var(--rare-sr); }
        .card[data-rarity="SSR"] { border-color: var(--rare-ssr); box-shadow:0 0 12px var(--rare-ssr); animation:holo 3s infinite; }
        @keyframes holo { 0% { filter:brightness(1); } 50% { filter:brightness(1.3); } 100% { filter:brightness(1); } }

        .card-art-area { width:100%; height:55%; position:relative; }
        .card-info-area { height:45%; background:rgba(0,0,0,0.8); padding:2px; display:flex; flex-direction:column; justify-content:space-between; }
        .card-symbol { font-size:14px; font-weight:bold; color:var(--primary); text-align:center; }
        .card-name { font-size:9px; text-align:center; white-space:nowrap; overflow:hidden; }
        .stats { display:flex; justify-content:space-between; font-size:10px; font-weight:bold; padding:0 2px; }
        .stat-atk { color:#e67e22; } .stat-hp { color:#2ecc71; }

        .card.selected { transform:translateY(-15px); border-color:var(--accent); box-shadow:0 0 15px var(--accent); z-index:10; }
        .card.can-attack { border-color:var(--success); box-shadow:0 0 10px var(--success); }
        .card.attacking { transform:scale(1.2); z-index:100; border-color:var(--danger); box-shadow:0 0 20px var(--danger); }

        /* UI */
        .leader { text-align:center; width:60px; } .leader-name { font-size:10px; color:var(--accent); }
        .hp-circle { width:35px; height:35px; border-radius:50%; background:#c0392b; border:2px solid white; color:white; font-weight:bold; line-height:35px; margin:0 auto; }
        .action-overlay { position:absolute; bottom:35%; right:10px; display:flex; flex-direction:column; gap:10px; z-index:50; }
        .game-btn { padding:10px 15px; border-radius:20px; border:none; font-weight:bold; color:white; font-size:12px; box-shadow:0 4px 5px rgba(0,0,0,0.5); }
        .btn-draw { background:#27ae60; } .btn-syn { background:#e67e22; }
        #cancel-btn { display:none; position:absolute; top:60%; left:50%; transform:translate(-50%,-50%); background:#c0392b; color:white; padding:10px 20px; border-radius:20px; font-weight:bold; z-index:200; }

        #msg-box { position:absolute; top:40%; left:50%; transform:translate(-50%,-50%); background:rgba(0,0,0,0.9); padding:15px 30px; border:2px solid white; border-radius:10px; font-weight:bold; font-size:20px; pointer-events:none; opacity:0; transition:0.3s; z-index:5000; white-space:nowrap; }

        #skill-modal { display:none; position:absolute; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:4000; flex-direction:column; justify-content:center; align-items:center; }
        .skill-btn { background:white; color:#333; padding:15px; margin:5px; border-radius:8px; width:80%; max-width:300px; font-weight:bold; cursor:pointer; }

        /* Ë©≥Á¥∞„Éë„Éç„É´ */
        #detail-panel { position:absolute; top:15%; left:50%; transform:translateX(-50%); width:80%; max-width:300px; background:rgba(20,20,30,0.95); border:2px solid var(--accent); border-radius:10px; padding:20px; display:none; flex-direction:column; color:white; z-index:3000; }
        
        #craftable-list { position:absolute; bottom:38%; left:10px; display:flex; flex-direction:column; gap:5px; pointer-events:none; z-index:40; }
        .craft-btn { background:rgba(0,0,0,0.9); border:1px solid var(--accent); color:white; padding:5px 10px; border-radius:5px; pointer-events:auto; font-size:12px; }

    </style>
</head>
<body>

    <div id="start-screen" class="screen">
        <h1 class="game-logo">CHEM-VERSE</h1>
        <div class="menu-btn" onclick="showDeckSelect()">CPU„Éê„Éà„É´</div>
        <div class="menu-btn" style="opacity:0.5">ÂØæ‰∫∫Êà¶ (Ê∫ñÂÇô‰∏≠)</div>
    </div>

    <div id="deck-select-screen" class="screen hidden">
        <h2 style="color:var(--accent)">„Éá„ÉÉ„Ç≠ÈÅ∏Êäû</h2>
        <div class="deck-grid" id="deck-grid"></div>
        <div class="menu-btn" onclick="showTitle()">Êàª„Çã</div>
    </div>

    <div id="game-board">
        <div id="enemy-hand-area"></div>
        <div id="enemy-field"></div>
        <div id="info-area">
            <div class="leader" onclick="attackLeader('enemy')">
                <div class="avatar">ü§ñ</div>
                <div class="leader-name" id="enemy-name">CPU</div>
                <div id="enemy-hp" class="hp-circle">25</div>
            </div>
            <div style="text-align:center">
                <div id="turn-display" style="font-size:12px; color:#aaa;">„Çø„Éº„É≥1</div>
                <div id="mp-display" style="font-size:14px; font-weight:bold; color:var(--success);">MP 1/1</div>
            </div>
            <button class="game-btn" style="background:#e67e22" id="btn-end" onclick="endTurn()">ÁµÇ‰∫Ü</button>
            <div class="leader">
                <div id="player-hp" class="hp-circle">25</div>
                <div class="leader-name">„ÅÇ„Å™„Åü</div>
                <div class="avatar">üßë‚Äçüî¨</div>
            </div>
        </div>
        <div id="craftable-list"></div>
        <div id="player-field"></div>
        <div id="player-hand-area"></div>
        <div id="cancel-btn" onclick="cancelAttack()">‚ùå ÊîªÊíÉ„Ç≠„É£„É≥„Çª„É´</div>
        
        <div id="detail-panel" onclick="this.style.display='none'">
            <div style="text-align:right; font-size:20px;">√ó</div>
            <div id="det-sym" style="font-size:40px; font-weight:bold; color:var(--primary); text-align:center;"></div>
            <div id="det-name" style="font-size:18px; font-weight:bold; text-align:center; margin-bottom:10px;"></div>
            <div id="det-stats" style="text-align:center; font-size:18px; margin-bottom:10px;"></div>
            <div id="det-desc" style="font-size:12px; line-height:1.5; color:#ccc;"></div>
            <div style="text-align:center; margin-top:20px; font-size:10px; color:#666;">(„Çø„ÉÉ„Éó„ÅßÈñâ„Åò„Çã)</div>
        </div>
    </div>

    <div class="action-overlay" id="action-btns">
        <button class="game-btn btn-draw" onclick="actionDraw()">Ôºã „Éâ„É≠„Éº</button>
        <button class="game-btn btn-syn" onclick="actionSynthesize()">‚öóÔ∏è ÂêàÊàê</button>
    </div>

    <div id="skill-modal">
        <h3>ÊäÄ„ÇíÈÅ∏Êäû</h3>
        <div id="skill-list" style="width:100%; display:flex; flex-direction:column; align-items:center;"></div>
        <button class="game-btn" style="background:#777; margin-top:20px;" onclick="document.getElementById('skill-modal').style.display='none'; cancelAttack();">„Ç≠„É£„É≥„Çª„É´</button>
    </div>

    <div id="msg-box"></div>

    <script>
        // „Éá„Éº„Çø (CSS„ÇØ„É©„Çπ art-H „Å™„Å©„Å´ÂØæÂøú)
        const ELEM = {
            H: { symbol: 'H', name: 'Ê∞¥Á¥†', rarity: 'N', css: 'art-H' },
            He: { symbol: 'He', name: '„Éò„É™„Ç¶„É†', rarity: 'SR', css: 'art-gas' },
            Li: { symbol: 'Li', name: '„É™„ÉÅ„Ç¶„É†', rarity: 'R', css: 'art-metal-gen' },
            C: { symbol: 'C', name: 'ÁÇ≠Á¥†', rarity: 'N', css: 'art-solid-gen' },
            N: { symbol: 'N', name: 'Á™íÁ¥†', rarity: 'N', css: 'art-gas' },
            O: { symbol: 'O', name: 'ÈÖ∏Á¥†', rarity: 'N', css: 'art-O' },
            F: { symbol: 'F', name: '„Éï„ÉÉÁ¥†', rarity: 'SR', css: 'art-toxic-gen' },
            Ne: { symbol: 'Ne', name: '„Éç„Ç™„É≥', rarity: 'SR', css: 'art-gas' },
            Na: { symbol: 'Na', name: '„Éä„Éà„É™„Ç¶„É†', rarity: 'N', css: 'art-metal-gen' },
            Mg: { symbol: 'Mg', name: '„Éû„Ç∞„Éç„Ç∑„Ç¶„É†', rarity: 'R', css: 'art-metal-gen' },
            Al: { symbol: 'Al', name: '„Ç¢„É´„Éü„Éã„Ç¶„É†', rarity: 'R', css: 'art-metal-gen' },
            Si: { symbol: 'Si', name: '„Ç±„Ç§Á¥†', rarity: 'R', css: 'art-solid-gen' },
            P: { symbol: 'P', name: '„É™„É≥', rarity: 'R', css: 'art-solid-gen' },
            S: { symbol: 'S', name: 'Á°´ÈªÑ', rarity: 'R', css: 'art-solid-gen' },
            Cl: { symbol: 'Cl', name: 'Â°©Á¥†', rarity: 'N', css: 'art-Cl' },
            Ar: { symbol: 'Ar', name: '„Ç¢„É´„Ç¥„É≥', rarity: 'SR', css: 'art-gas' },
            K: { symbol: 'K', name: '„Ç´„É™„Ç¶„É†', rarity: 'N', css: 'art-metal-gen' },
            Ca: { symbol: 'Ca', name: '„Ç´„É´„Ç∑„Ç¶„É†', rarity: 'R', css: 'art-metal-gen' },
            Fe: { symbol: 'Fe', name: 'ÈâÑ', rarity: 'N', css: 'art-metal-gen' },
            Cu: { symbol: 'Cu', name: 'ÈäÖ', rarity: 'N', css: 'art-metal-gen' },
            Zn: { symbol: 'Zn', name: '‰∫úÈâõ', rarity: 'R', css: 'art-metal-gen' },
            Ag: { symbol: 'Ag', name: 'ÈäÄ', rarity: 'SR', css: 'art-metal-gen' },
            Cd: { symbol: 'Cd', name: '„Ç´„Éâ„Éü„Ç¶„É†', rarity: 'R', css: 'art-toxic-gen' },
            Au: { symbol: 'Au', name: 'Èáë', rarity: 'SSR', css: 'art-Au' },
            Hg: { symbol: 'Hg', name: 'Ê∞¥ÈäÄ', rarity: 'SR', css: 'art-liquid-gen' },
            Pt: { symbol: 'Pt', name: '„Éó„É©„ÉÅ„Éä', rarity: 'SSR', css: 'art-metal-gen' },
            W: { symbol: 'W', name: '„Çø„É≥„Ç∞„Çπ„ÉÜ„É≥', rarity: 'SSR', css: 'art-metal-gen' },
            Ti: { symbol: 'Ti', name: '„ÉÅ„Çø„É≥', rarity: 'SR', css: 'art-metal-gen' }
        };

        const RECIPES = [
            { ingredients: ['H', 'Cl'], product: { symbol: 'HCl', name: 'Â°©ÂåñÊ∞¥Á¥†', rarity:'R', atk: 5, hp: 1, css:'art-toxic-gen', skills: [{name:'Âº∑ÈÖ∏ËÖêÈ£ü', power:5, desc:'È´òÁÅ´Âäõ'}] }},
            { ingredients: ['H', 'F'], product: { symbol: 'HF', name: '„Éï„ÉÉÂåñÊ∞¥Á¥†', rarity:'SR', atk: 4, hp: 2, ability:'toxic', css:'art-toxic-gen', skills: [{name:'„Ç¨„É©„ÇπËÖêÈ£ü', power:4, desc:'ÊîªÊíÉ'}, {name:'ÁåõÊØí', power:0, type:'toxic', desc:'ÂøÖÊÆ∫'}] }},
            { ingredients: ['H', 'H', 'O'], product: { symbol: 'H2O', name: 'Ê∞¥', rarity:'N', atk: 1, hp: 4, css:'art-liquid-gen', skills: [{name:'Ê∞¥ÊµÅ', power:1, desc:'ÊîªÊíÉ'}, {name:'Âä†Ê∞¥ÂàÜËß£', power:3, type:'heal', desc:'HP3ÂõûÂæ©'}] }},
            { ingredients: ['Ag', 'Cl'], product: { symbol: 'AgCl', name: 'Â°©ÂåñÈäÄ', rarity:'SR', atk: 1, hp: 6, ability:'ward', css:'art-solid-gen', skills: [{name:'ÁôΩËâ≤Ê≤àÊÆø', power:0, type:'guard', desc:'ÂÆàË≠∑'}] }},
            { ingredients: ['Fe', 'O', 'O'], product: { symbol: 'Fe2O3', name: 'Ëµ§ÈåÜ', rarity:'R', atk: 2, hp: 8, ability:'ward', css:'art-solid-gen', skills: [{name:'‰∏çÂãïÊÖã', power:2, desc:'È´òËÄê‰πÖ'}] }},
            { ingredients: ['C', 'O'], product: { symbol: 'CO', name: '‰∏ÄÈÖ∏ÂåñÁÇ≠Á¥†', rarity:'R', atk: 1, hp: 2, ability:'toxic', css:'art-gas', skills: [{name:'ÁåõÊØí„Ç¨„Çπ', power:0, type:'toxic', desc:'ÂøÖÊÆ∫'}] }},
            { ingredients: ['H', 'S'], product: { symbol: 'H2S', name: 'Á°´ÂåñÊ∞¥Á¥†', rarity:'R', atk: 2, hp: 3, ability:'toxic', css:'art-Cl', skills: [{name:'ËÖêÂçµËá≠', power:0, type:'toxic', desc:'ÂøÖÊÆ∫'}] }},
            { ingredients: ['Cl', 'Cl'], product: { symbol: 'Cl2', name: 'Â°©Á¥†„Ç¨„Çπ', rarity:'R', atk: 3, hp: 3, css:'art-Cl', skills: [{name:'ÊØí„Ç¨„ÇπÊï£Â∏É', power:2, type:'aoe', desc:'ÂÖ®‰Ωì2„ÉÄ„É°'}] }},
            { ingredients: ['Na', 'O', 'H'], product: { symbol: 'NaOH', name: 'Ê∞¥ÈÖ∏ÂåñNa', rarity:'R', atk: 3, hp: 3, css:'art-solid-gen', skills: [{name:'ÊΩÆËß£', power:3, desc:'ÊîªÊíÉ'}, {name:'‰∏≠ÂíåÁÜ±', power:2, type:'aoe_heal', desc:'ÂÖ®‰Ωì2„ÉÄ„É°/2ÂõûÂæ©'}] }},
            { ingredients: ['C', 'C', 'C'], product: { symbol: 'Diamond', name: '„ÉÄ„Ç§„É§„É¢„É≥„Éâ', rarity:'SSR', atk: 4, hp: 10, ability:'ward', css:'art-Au', skills: [{name:'ÊúÄÂº∑Á°¨Â∫¶', power:4, desc:'ÈâÑÂ£Å'}] }},
            { ingredients: ['Au'], product: { symbol: 'Au', name: 'Èáë', rarity:'SSR', atk: 6, hp: 6, css:'art-Au', skills: [{name:'‰∏çÂ§â„ÅÆËºù„Åç', power:6, desc:'È´òÁÅ´Âäõ'}] }},
            { ingredients: ['H', 'Cl', 'N', 'O', 'O', 'O'], product: { symbol: 'AquaRegia', name: 'ÁéãÊ∞¥', rarity:'SSR', atk: 0, hp: 0, type:'spell', css:'art-liquid-gen', skills: [{name:'ÈáëÊ∫∂„Åã„Åó', power:99, type:'toxic', desc:'Á¢∫ÂÆöÈô§Âéª'}] }},
            // ‰ªñ„ÅÆ„É¨„Ç∑„Éî„ÇÇÂêåÊßò„Å´CSS„ÇØ„É©„Çπ„ÇíÂâ≤„ÇäÂΩì„Å¶„Å¶‰ΩøÁî®ÔºàÁúÅÁï•ÊôÇ„ÅØgenÔºâ
        ];

        const DECKS = {
            aggro: { name: 'Ë∂ÖÈÄüÊîª', elements: ['H', 'H', 'Cl', 'F', 'Na', 'O'], recipes: ['HCl', 'HF', 'H2O'] },
            counter: { name: '„Ç´„Ç¶„É≥„Çø„Éº', elements: ['Ag', 'Cl', 'Fe', 'O'], recipes: ['AgCl', 'Fe2O3'] },
            toxic: { name: 'ÂÆ≥ÊÇ™ÊØí', elements: ['C', 'O', 'S', 'H', 'Cl'], recipes: ['CO', 'H2S', 'Cl2'] },
            control: { name: '„Ç≥„É≥„Éà„É≠„Éº„É´', elements: ['Na', 'O', 'H', 'Al'], recipes: ['NaOH'] },
            gemstone: { name: 'ÂÆùÁü≥', elements: ['C', 'C', 'C'], recipes: ['Diamond'] },
            heavy: { name: 'ÈáçÈáëÂ±û', elements: ['Au', 'Pt', 'W'], recipes: ['Au'] },
            hazard: { name: 'Âç±Èô∫Áâ©', elements: ['H', 'Cl', 'N', 'O'], recipes: ['AquaRegia'] }
        };

        let gs = { hp:25, enemyHp:25, hand:[], field:[], enemyHand:[], enemyField:[], turn:1, mp:1, maxMp:1, isPlayerTurn:true, selected:[], attacker:null };

        // --- ÂàùÊúüÂåñ ---
        window.onload = () => {
            const grid = document.getElementById('deck-grid');
            for(let key in DECKS) {
                const d = document.createElement('div'); d.className='deck-card';
                d.innerHTML = `<div class="deck-title">${DECKS[key].name}</div><div class="deck-desc">„Éá„ÉÉ„Ç≠„ÇíÈÅ∏Êäû</div>`;
                d.onclick = () => startGame(key);
                grid.appendChild(d);
            }
            showTitle();
        };

        function showTitle() { hideAll(); document.getElementById('start-screen').style.display='flex'; }
        function showDeckSelect() { hideAll(); document.getElementById('deck-select-screen').style.display='block'; }
        function hideAll() { document.querySelectorAll('.screen').forEach(e=>e.style.display='none'); document.getElementById('game-board').style.display='none'; document.getElementById('action-btns').style.display='none'; }

        function startGame(key) {
            gs = { hp:25, enemyHp:25, hand:[], field:[], enemyHand:[], enemyField:[], turn:1, mp:1, maxMp:1, isPlayerTurn:true, selected:[], attacker:null };
            gs.pool = DECKS[key].elements.map(s => ELEM[s]);
            gs.recipes = RECIPES; // Á∞°ÊòìÂåñ„ÅÆ„Åü„ÇÅÂÖ®„É¨„Ç∑„ÉîÊúâÂäπ
            gs.enemyPool = DECKS[Object.keys(DECKS)[Math.floor(Math.random()*Object.keys(DECKS).length)]].elements.map(s=>ELEM[s]);
            
            hideAll();
            document.getElementById('game-board').style.display='flex';
            document.getElementById('action-btns').style.display='flex';
            
            for(let i=0; i<5; i++) { draw(true); draw(false); }
            updateView();
            msg("„Éê„Éà„É´ÈñãÂßãÔºÅ");
        }

        function draw(isPlayer) {
            const pool = isPlayer ? gs.pool : gs.enemyPool;
            const card = { ...pool[Math.floor(Math.random()*pool.length)], id: Math.random(), type:'element' };
            if(isPlayer) { if(gs.hand.length<10) gs.hand.push(card); }
            else { if(gs.enemyHand.length<10) gs.enemyHand.push(card); }
        }

        function actionDraw() {
            if(!gs.isPlayerTurn || gs.mp<1) { msg("MP‰∏çË∂≥"); return; }
            gs.mp--; draw(true); updateView();
        }

        function actionSynthesize() {
            if(!gs.isPlayerTurn || gs.selected.length<1) return;
            // Âçò‰ΩìÈáëÂ±û
            if(gs.selected.length===1) {
                const c = gs.hand.find(x=>x.id===gs.selected[0]);
                const rec = gs.recipes.find(r=>r.ingredients.length===1 && r.ingredients[0]===c.symbol);
                if(rec) { processSynth(rec); return; }
            }
            // Ë§áÊï∞
            const sel = gs.hand.filter(c=>gs.selected.includes(c.id));
            const syms = sel.map(c=>c.symbol).sort();
            const rec = gs.recipes.find(r=>JSON.stringify(r.ingredients.sort())===JSON.stringify(syms));
            if(rec) processSynth(rec);
            else { msg("ÂèçÂøú„Åó„Åæ„Åõ„Çì"); gs.selected=[]; updateView(); }
        }

        function processSynth(rec) {
            // „Çπ„Éö„É´
            if(rec.product.type==='spell') {
                gs.hand = gs.hand.filter(c=>!gs.selected.includes(c.id)); gs.selected=[];
                // Á∞°ÊòìÂäπÊûú
                if(gs.enemyField.length>0) { gs.enemyField[0].currentHp-=99; msg("Êïµ„ÇíÁ†¥Â£äÔºÅ"); }
                else { gs.enemyHp-=5; msg("„É™„Éº„ÉÄ„Éº„Å´„ÉÄ„É°„Éº„Ç∏ÔºÅ"); }
                checkEnd(); updateView(); return;
            }
            if(gs.field.length>=MAX_FIELD) { msg("Ê∫ÄÂì°„Åß„Åô"); return; }
            gs.hand = gs.hand.filter(c=>!gs.selected.includes(c.id)); gs.selected=[];
            const u = { ...rec.product, id:Math.random(), maxHp:rec.product.hp, currentHp:rec.product.hp, canAttack:rec.product.ability==='storm', type:'unit' };
            gs.field.push(u);
            msg("Âè¨ÂñöÔºÅ"); updateView();
        }

        function onHandClick(id) {
            if(!gs.isPlayerTurn) return;
            const c = gs.hand.find(x=>x.id===id); showDetail(c);
            if(gs.selected.includes(id)) gs.selected = gs.selected.filter(x=>x!==id);
            else gs.selected.push(id);
            updateView();
        }

        function onFieldClick(id, isPlayer) {
            if(!gs.isPlayerTurn) return;
            if(isPlayer) {
                const u = gs.field.find(x=>x.id===id); showDetail(u);
                if(u && u.canAttack) { gs.attacker = u; document.body.classList.add('targeting'); updateView(); }
            } else if(gs.attacker) {
                // ÊîªÊíÉ
                const target = gs.enemyField.find(x=>x.id===id);
                attack(gs.attacker, target);
            } else {
                const u = gs.enemyField.find(x=>x.id===id); showDetail(u);
            }
        }

        function attackLeader(side) {
            if(side==='enemy' && gs.attacker) attack(gs.attacker, 'leader');
        }

        function attack(atk, def) {
            // ÂÆàË≠∑„ÉÅ„Çß„ÉÉ„ÇØÁúÅÁï•(Á∞°ÊòìÁâà)
            if(def==='leader') {
                gs.enemyHp -= atk.atk;
            } else {
                def.currentHp -= atk.atk;
                atk.currentHp -= def.atk;
            }
            atk.canAttack = false;
            cancelAttack(); checkEnd(); updateView();
        }

        function cancelAttack() { gs.attacker=null; document.body.classList.remove('targeting'); updateView(); }

        function checkEnd() {
            gs.field = gs.field.filter(u=>u.currentHp>0);
            gs.enemyField = gs.enemyField.filter(u=>u.currentHp>0);
            if(gs.enemyHp<=0) alert("ÂãùÂà©ÔºÅ");
            if(gs.hp<=0) alert("ÊïóÂåó...");
        }

        function endTurn() {
            gs.isPlayerTurn=false; cancelAttack(); updateView(); msg("Êïµ„ÅÆ„Çø„Éº„É≥");
            setTimeout(cpuTurn, 1000);
        }

        async function cpuTurn() {
            if(gs.maxMp<10) gs.maxMp++; gs.mp=gs.maxMp;
            draw(false); updateView();
            // Á∞°ÊòìCPU: ÊîªÊíÉ„ÅÆ„Åø
            gs.enemyField.forEach(u=>u.canAttack=true);
            for(let u of gs.enemyField) {
                if(gs.hp>0) { gs.hp -= u.atk; msg("CPUÊîªÊíÉ"); await new Promise(r=>setTimeout(r,500)); updateView(); }
            }
            checkEnd();
            gs.turn++; gs.isPlayerTurn=true; 
            gs.field.forEach(u=>u.canAttack=true);
            draw(true); msg("„ÅÇ„Å™„Åü„ÅÆ„Çø„Éº„É≥"); updateView();
        }

        function updateView() {
            document.getElementById('turn-display').innerText = `„Çø„Éº„É≥ ${gs.turn}`;
            document.getElementById('mp-display').innerText = `MP ${gs.mp}/${gs.maxMp}`;
            document.getElementById('player-hp').innerText = gs.hp;
            document.getElementById('enemy-hp').innerText = gs.enemyHp;
            document.getElementById('cancel-btn').style.display = gs.attacker ? 'block' : 'none';

            render(document.getElementById('player-hand-area'), gs.hand, 'hand', true);
            render(document.getElementById('player-field'), gs.field, 'field', true);
            render(document.getElementById('enemy-field'), gs.enemyField, 'field', false);
            // ÊïµÊâãÊú≠
            const eh = document.getElementById('enemy-hand-area'); eh.innerHTML='';
            gs.enemyHand.forEach(()=>{
                const d=document.createElement('div'); d.className='card'; d.style.background='#444'; d.style.width='30px'; d.style.height='45px';
                eh.appendChild(d);
            });
            updateHint();
        }

        function render(el, list, type, isPlayer) {
            el.innerHTML='';
            list.forEach(c => {
                const d = document.createElement('div'); d.className='card';
                // CSS Art
                let artClass = c.css || 'art-solid-gen';
                if(c.type==='element') {
                    d.innerHTML = `<div class="card-art-area ${artClass} css-art"></div><div class="card-info-area"><div class="card-symbol">${c.symbol}</div><div class="card-name">${c.name}</div></div>`;
                } else {
                    let badges = `<div class="ability-container">`;
                    if(c.ability === 'ward') badges += `<div class="badge badge-ward">üõ°Ô∏è</div>`;
                    if(c.ability === 'toxic') badges += `<div class="badge badge-toxic">‚ò†Ô∏è</div>`;
                    if(c.ability === 'storm') badges += `<div class="badge badge-storm">‚ö°</div>`;
                    badges += `</div>`;
                    d.innerHTML = `${badges}<div class="card-art-area ${artClass} css-art"></div><div class="card-info-area"><div class="card-symbol" style="color:var(--primary)">${c.symbol}</div><div class="card-name">${c.name}</div><div class="stats"><span class="stat-atk">‚öîÔ∏è${c.atk}</span><span class="stat-hp">‚ù§Ô∏è${c.currentHp}</span></div></div>`;
                }
                
                if(type==='hand' && gs.selected.includes(c.id)) d.classList.add('selected');
                if(type==='field' && c.canAttack && isPlayer) d.classList.add('can-attack');
                if(type==='field' && !isPlayer && gs.attacker) d.classList.add('valid-target');

                d.onclick = (e) => { e.stopPropagation(); if(type==='hand') onHandClick(c.id); else onFieldClick(c.id, isPlayer); };
                el.appendChild(d);
            });
        }

        function updateHint() {
            const list = document.getElementById('craftable-list'); list.innerHTML='';
            if(!gs.isPlayerTurn) return;
            gs.recipes.forEach(r => {
                const handSym = gs.hand.map(c=>c.symbol);
                let possible = true;
                for(let ing of r.ingredients) {
                    const idx = handSym.indexOf(ing);
                    if(idx===-1) { possible=false; break; }
                    handSym.splice(idx,1);
                }
                if(possible) {
                    const b = document.createElement('div'); b.className='craft-btn';
                    b.innerText = `‚ú® ${r.product.name}`;
                    b.onclick = () => {
                        gs.selected = []; const tempHand=[...gs.hand];
                        r.ingredients.forEach(ing => {
                            const idx = tempHand.findIndex(x=>x.symbol===ing);
                            if(idx!==-1) { gs.selected.push(tempHand[idx].id); tempHand.splice(idx,1); }
                        });
                        updateView();
                    };
                    list.appendChild(b);
                }
            });
        }

        function showDetail(c) {
            const p = document.getElementById('detail-panel'); p.style.display='flex';
            document.getElementById('det-sym').innerText = c.symbol;
            document.getElementById('det-name').innerText = c.name;
            if(c.type!=='element') {
                document.getElementById('det-stats').innerHTML = `‚öîÔ∏è${c.atk} <span style="margin-left:10px; color:var(--success)">‚ù§Ô∏è${c.currentHp}/${c.maxHp}</span>`;
                document.getElementById('det-desc').innerText = (c.skills||[]).map(s=>`„Äê${s.name}„Äë${s.desc}`).join('\n');
            } else {
                document.getElementById('det-stats').innerText = '';
                document.getElementById('det-desc').innerText = 'ÂêàÊàêÁ¥†Êùê';
            }
        }

        function msg(t) { const b=document.getElementById('msg-box'); b.innerText=t; b.style.opacity=1; setTimeout(()=>b.style.opacity=0,1500); }

    </script>
</body>
</html>