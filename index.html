<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Chem-Verse: TCG Style</title>
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700;900&family=Orbitron:wght@700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #1a1a1d;
            --accent: #f1c40f;
            --primary: #3498db;
            --danger: #e74c3c;
            --success: #2ecc71;
            --card-bg: #2c3e50;
            --card-frame: #bdc3c7;
            --rare-n: #95a5a6;
            --rare-r: #3498db;
            --rare-sr: #9b59b6;
            --rare-ssr: #f1c40f;
        }

        body {
            font-family: 'M PLUS Rounded 1c', sans-serif;
            background-color: var(--bg-color); color: white; margin: 0; user-select: none;
            overflow: hidden; -webkit-tap-highlight-color: transparent;
            height: 100vh; width: 100vw;
        }

        /* --- ÂÖ±ÈÄö: ÁîªÈù¢Âàá„ÇäÊõø„Åà --- */
        .screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            z-index: 100; transition: opacity 0.3s;
        }
        .hidden { display: none !important; opacity: 0; pointer-events: none; }

        /* --- „É™„ÉÉ„ÉÅ„Å™CSS„Ç§„É©„Çπ„Éà --- */
        .art-frame {
            width: 100%; height: 100%; position: relative; overflow: hidden;
            border-radius: 4px; border: 2px solid rgba(0,0,0,0.5); box-sizing: border-box;
            background: #333; display: flex; justify-content: center; align-items: center;
        }
        .css-art { width: 100%; height: 100%; position: absolute; top: 0; left: 0; }

        /* Ê∞ó‰ΩìÁ≥ª: Ê∏¶Â∑ª„ÅèÈõ≤ */
        .art-p-gas { background: linear-gradient(to top right, #89f7fe, #66a6ff); }
        .art-p-gas::before, .art-p-gas::after { content: '‚òÅÔ∏è'; position: absolute; font-size: 40px; filter: drop-shadow(0 0 10px white); opacity: 0.7; animation: float 6s infinite ease-in-out; }
        .art-p-gas::before { top: 10%; left: 10%; animation-delay: 0s; }
        .art-p-gas::after { bottom: 10%; right: 10%; animation-delay: -3s; font-size: 30px; }

        /* Ê∂≤‰ΩìÁ≥ª: Ê≥¢„Å®Ê≥° */
        .art-p-liquid { background: linear-gradient(to bottom, #4facfe, #00f2fe); }
        .art-p-liquid::before { content: 'üåä'; position: absolute; bottom: -10px; font-size: 60px; width: 100%; text-align: center; animation: wave 3s infinite linear; opacity: 0.8; }
        .art-p-liquid::after { content: 'ü´ß'; position: absolute; top: 20%; left: 30%; font-size: 30px; animation: floatUp 4s infinite linear; }

        /* Âõ∫‰Ωì„ÉªÂ≤©Á≥ª: „Ç¥„ÉÑ„Ç¥„ÉÑ */
        .art-p-solid { background: linear-gradient(45deg, #e6b980, #eacda3, #8d6e63); }
        .art-p-solid::before { content: 'ü™®'; position: absolute; bottom: 5px; left: 5px; font-size: 50px; filter: drop-shadow(2px 2px 5px #333); }
        .art-p-solid::after { content: '‚õ∞Ô∏è'; position: absolute; bottom: 5px; right: 5px; font-size: 40px; opacity: 0.7; }

        /* ÈáëÂ±ûÁ≥ª: ÂÖâÊ≤¢„Å®Ëºù„Åç */
        .art-p-metal { background: linear-gradient(135deg, #bdc3c7, #2c3e50, #bdc3c7); background-size: 200% 200%; animation: shine 5s infinite linear; }
        .art-p-metal::before { content: '‚öôÔ∏è'; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 50px; opacity: 0.3; }
        .art-p-metal::after { content: '‚ú®'; position: absolute; top: 10%; right: 10%; font-size: 30px; animation: twinkle 2s infinite; }

        /* ÊØíÁ≥ª: Âç±Èô∫„Å™Èõ∞Âõ≤Ê∞ó */
        .art-p-toxic { background: linear-gradient(to bottom, #764ba2, #667eea); }
        .art-p-toxic::before { content: '‚ò†Ô∏è'; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 50px; color: #fff; filter: drop-shadow(0 0 10px purple); }
        .art-p-toxic::after { content: 'üí®'; position: absolute; bottom: 10%; font-size: 40px; opacity: 0.5; animation: flow 4s infinite linear; }

        /* ÁÇé„ÉªÁàÜÁô∫Á≥ª (‰æã: Ê∞¥Á¥†) */
        .art-p-fire { background: linear-gradient(to top, #e74c3c, #f1c40f); }
        .art-p-fire::before { content: 'üî•'; position: absolute; bottom: 0; font-size: 60px; width: 100%; text-align: center; animation: burn 1s infinite alternate; }
        .art-p-fire::after { content: 'üí•'; position: absolute; top: 10%; font-size: 40px; animation: twinkle 0.5s infinite; }

        /* Èõ∑Á≥ª */
        .art-p-storm { background: linear-gradient(to bottom, #302b63, #24243e); }
        .art-p-storm::before { content: '‚ö°'; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 70px; color: var(--accent); filter: drop-shadow(0 0 20px var(--accent)); animation: twinkle 0.2s infinite; }

        /* Èáë„ÉªÂÆùÁü≥Á≥ª */
        .art-p-gold { background: radial-gradient(circle, #ffd700, #b8860b); }
        .art-p-gold::before { content: 'üíé'; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 50px; filter: drop-shadow(0 0 15px gold); animation: float 4s infinite ease-in-out; }
        .art-p-gold::after { content: '‚ú®'; position: absolute; font-size: 20px; animation: twinkle 3s infinite; top:20%; left:20%; }

        /* „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥ÂÆöÁæ© */
        @keyframes float { 0%, 100% { transform: translateY(0) rotate(0deg); } 50% { transform: translateY(-10px) rotate(5deg); } }
        @keyframes wave { 0% { transform: translateX(-20px); } 100% { transform: translateX(20px); } }
        @keyframes floatUp { 0% { transform: translateY(50px); opacity: 0; } 50% { opacity: 1; } 100% { transform: translateY(-50px); opacity: 0; } }
        @keyframes shine { 0% { background-position: 0% 50%; } 100% { background-position: 100% 50%; } }
        @keyframes twinkle { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.5; transform: scale(0.8); } }
        @keyframes flow { 0% { transform: translateX(-50px); } 100% { transform: translateX(50px); } }
        @keyframes burn { 0% { transform: scale(1); filter: brightness(1); } 100% { transform: scale(1.1); filter: brightness(1.3); } }


        /* --- „Çø„Ç§„Éà„É´ÁîªÈù¢ --- */
        #title-screen { background: radial-gradient(circle at center, #2c3e50 0%, #000000 100%); overflow: hidden; }
        .particle { position: absolute; border-radius: 50%; background: rgba(255,255,255,0.5); animation: floatUpParticle linear infinite; z-index: 0; }
        @keyframes floatUpParticle { from { transform: translateY(100vh) scale(0); opacity: 0; } to { transform: translateY(-10vh) scale(1); opacity: 1; } }
        .game-logo { font-family: 'Orbitron', sans-serif; font-size: 40px; color: var(--accent); text-shadow: 0 0 20px var(--accent); margin-bottom: 10px; z-index: 10; text-align: center; }
        .menu-container { display: flex; flex-direction: column; gap: 15px; width: 80%; max-width: 300px; z-index: 10; }
        .menu-btn { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 15px; border-radius: 30px; font-weight: bold; cursor: pointer; text-align: center; backdrop-filter: blur(5px); }
        .menu-btn.primary { background: linear-gradient(90deg, var(--primary), #2980b9); border: none; }
        
        /* --- „Éá„ÉÉ„Ç≠ÈÅ∏Êäû --- */
        #deck-select-screen { padding-top: 40px; justify-content: flex-start; }
        .deck-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; width: 100%; max-width: 600px; padding: 20px; box-sizing: border-box; overflow-y: auto; }
        .deck-card { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); padding: 15px; border-radius: 12px; cursor: pointer; display: flex; flex-direction: column; justify-content: space-between; min-height: 100px; position: relative; overflow: hidden; }
        .deck-card::before { content:''; position: absolute; top:0; left:0; width:4px; height:100%; background: var(--accent); }
        .deck-title { font-weight: bold; color: #fff; } .deck-desc { font-size: 10px; color: #aaa; }
        
        /* --- „Ç≤„Éº„É†„Éú„Éº„Éâ --- */
        #game-board { display: none; flex-direction: column; height: 100vh; background: #111; }
        #enemy-hand-area { height: 10%; background: rgba(0,0,0,0.3); display: flex; justify-content: center; align-items: center; gap: -10px; }
        #enemy-field { height: 25%; border-bottom: 2px solid #333; display: flex; justify-content: center; align-items: center; }
        #info-area { height: 10%; background: rgba(30,30,40,0.9); display: flex; justify-content: space-between; align-items: center; padding: 0 10px; z-index: 10; border-top: 1px solid #444; border-bottom: 1px solid #444; }
        #player-field { height: 25%; border-top: 2px solid #333; display: flex; justify-content: center; align-items: center; }
        #player-hand-area { height: 30%; background: rgba(0,0,0,0.2); overflow-x: auto; display: flex; align-items: center; padding-left: 10px; }

        /* --- Êñ∞„Åó„ÅÑ„Ç´„Éº„Éâ„Éá„Ç∂„Ç§„É≥ (TCGÈ¢®) --- */
        .card {
            width: 80px; height: 115px; /* „Çµ„Ç§„Ç∫Ë™øÊï¥ */
            background: var(--card-bg); border-radius: 6px;
            border: 2px solid var(--card-frame); box-shadow: 0 4px 8px rgba(0,0,0,0.5);
            display: flex; flex-direction: column; padding: 3px; box-sizing: border-box;
            position: relative; flex-shrink: 0; margin: 0 4px;
            transition: transform 0.1s, z-index 0.1s;
        }
        /* „É¨„Ç¢„É™„ÉÜ„Ç£Âà•„ÅÆÊû† */
        .card[data-rarity="N"] { border-color: var(--rare-n); }
        .card[data-rarity="R"] { border-color: var(--rare-r); box-shadow: 0 0 4px var(--rare-r); }
        .card[data-rarity="SR"] { border-color: var(--rare-sr); box-shadow: 0 0 6px var(--rare-sr); background: linear-gradient(135deg, #2c3e50, #4a235a); }
        .card[data-rarity="SSR"] { border-color: var(--rare-ssr); box-shadow: 0 0 8px var(--rare-ssr); background: linear-gradient(135deg, #f1c40f, #e67e22, #f1c40f); animation: holoBG 3s infinite linear; }
        @keyframes holoBG { 0% { background-position: 0% 50%; } 100% { background-position: 100% 50%; } }

        .card-header { display: flex; justify-content: space-between; align-items: center; font-size: 8px; font-weight: bold; color: #eee; margin-bottom: 2px; padding: 0 2px; }
        .card-symbol-small { color: var(--accent); }
        
        .card-art-container {
            width: 100%; height: 65px; /* „Ç§„É©„Çπ„ÉàÈ†òÂüü„ÅÆÈ´ò„Åï */
            background: #000; border: 1px solid rgba(255,255,255,0.3);
            margin-bottom: 3px; position: relative;
        }
        
        .card-text-box {
            flex-grow: 1; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2);
            font-size: 7px; padding: 2px; color: #ddd; overflow: hidden;
            display: flex; flex-direction: column; justify-content: flex-start;
        }
        .skill-name-small { font-weight: bold; color: var(--accent); }

        .card-stats-container {
            display: flex; justify-content: space-between; margin-top: 2px;
            font-size: 10px; font-weight: 900; color: white;
            position: absolute; bottom: 3px; width: calc(100% - 6px);
        }
        .stat-atk-box { background: linear-gradient(45deg, #e67e22, #d35400); padding: 1px 5px; border-radius: 4px 0 4px 0; border: 1px solid #fff; }
        .stat-hp-box { background: linear-gradient(45deg, #27ae60, #2ecc71); padding: 1px 5px; border-radius: 0 4px 0 4px; border: 1px solid #fff; }

        /* „Ç¢„Éì„É™„ÉÜ„Ç£„Ç¢„Ç§„Ç≥„É≥ */
        .card-badges { position: absolute; top: 2px; right: 2px; display: flex; gap: 1px; z-index: 5; }
        .c-badge { width: 12px; height: 12px; font-size: 8px; border-radius: 50%; display: flex; center; border: 1px solid #fff; }
        .cb-ward { background: var(--primary); } .cb-toxic { background: #8e44ad; } .cb-storm { background: var(--accent); } .cb-stealth { background: var(--rare-n); }

        /* Áä∂ÊÖãÂ§âÂåñ */
        .card.selected { transform: translateY(-20px) scale(1.1); z-index: 100; border-color: var(--accent); box-shadow: 0 0 15px var(--accent); }
        .card.can-attack { border-color: var(--success); box-shadow: 0 0 10px var(--success); }
        .card.attacking { transform: scale(1.2) !important; z-index: 200; border-color: var(--danger); box-shadow: 0 0 20px var(--danger); }
        .card.valid-target { animation: pulse 0.8s infinite; border-color: var(--danger)!important; }

        /* UI„Éë„Éº„ÉÑ */
        .leader { text-align: center; width: 70px; }
        .hp-circle { background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; border-radius: 50%; width: 38px; height: 38px; line-height: 38px; font-weight: bold; font-size: 16px; margin: 0 auto; border: 2px solid white; box-shadow: 0 0 8px rgba(231, 76, 60, 0.8); }
        .mp-bar { font-size: 14px; color: var(--success); font-weight: bold; }
        .action-overlay { position: absolute; bottom: 33%; right: 10px; display: flex; flex-direction: column; gap: 10px; z-index: 50; }
        .game-btn { padding: 10px 16px; border-radius: 20px; border: none; font-weight: bold; color: white; cursor: pointer; box-shadow: 0 4px 8px rgba(0,0,0,0.4); }
        .btn-draw { background: linear-gradient(to right, #27ae60, #2ecc71); } 
        .btn-syn { background: linear-gradient(to right, #f39c12, #f1c40f); color: #333; }
        #btn-end-turn { padding: 6px 12px; background: #e67e22; border-radius: 15px; border: none; color: white; font-weight: bold; }

        /* „É¢„Éº„ÉÄ„É´„ÉªÁµêÊûú */
        #result-screen { background: rgba(0,0,0,0.9); z-index: 5000; backdrop-filter: blur(10px); }
        .result-title { font-size: 48px; font-weight: 800; margin-bottom: 20px; font-family: 'Orbitron', sans-serif; }
        .result-win { color: var(--accent); } .result-lose { color: var(--danger); }
        .confetti { position: absolute; width: 10px; height: 10px; background-color: #f00; animation: confetti-fall linear forwards; }
        @keyframes confetti-fall { 0% { transform: translateY(-10vh) rotate(0deg); } 100% { transform: translateY(110vh) rotate(720deg); } }
        
        #card-detail-panel { position: absolute; top: 10%; left: 50%; transform: translateX(-50%); width: 90%; max-width: 340px; background: rgba(20, 20, 30, 0.98); border: 2px solid var(--accent); border-radius: 12px; padding: 15px; display: none; flex-direction: column; color: white; z-index: 3000; box-shadow: 0 0 40px rgba(0,0,0,0.8); }
        .big-art { width: 100%; height: 150px; margin: 10px 0; border-radius: 8px; border: 2px solid #555; }

        #craftable-list { position: absolute; bottom: 35%; left: 10px; display: flex; flex-direction: column; gap: 5px; z-index: 40; pointer-events: none; }
        .craft-hint-btn { background: rgba(0, 0, 0, 0.9); border: 1px solid var(--accent); color: white; padding: 8px 12px; border-radius: 8px; pointer-events: auto; display: flex; flex-direction: column; min-width: 140px; box-shadow: 0 0 10px rgba(241, 196, 15, 0.3); cursor: pointer; }
        
        #msg-box { position: absolute; top: 40%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.9); padding: 15px 30px; border-radius: 8px; border: 2px solid white; font-size: 20px; font-weight: bold; pointer-events: none; opacity: 0; transition: 0.3s; z-index: 5000; text-align: center; white-space: nowrap; }

    </style>
</head>
<body>

    <div id="title-screen" class="screen">
        <div id="particles"></div>
        <div class="game-logo">CHEM-VERSE</div>
        <div class="menu-container">
            <div class="menu-btn primary" onclick="showDeckSelect()">CPU„Éê„Éà„É´</div>
            <div class="menu-btn disabled">ÂØæ‰∫∫Êà¶ (Ê∫ñÂÇô‰∏≠)</div>
            <div class="menu-btn disabled">„Ç´„Éº„ÉâÂõ≥Èëë (Ê∫ñÂÇô‰∏≠)</div>
        </div>
    </div>

    <div id="deck-select-screen" class="screen hidden">
        <div style="padding: 20px; width: 100%; text-align: center;"><h2 class="deck-header">„Éá„ÉÉ„Ç≠ÈÅ∏Êäû</h2></div>
        <div class="deck-grid" id="deck-grid-container">
            </div>
        <div class="back-btn menu-btn" style="position: fixed; bottom: 20px; width: auto; background:#333;" onclick="showTitle()">Êàª„Çã</div>
    </div>

    <div id="game-board">
        <div id="enemy-hand-area"></div>
        <div id="enemy-field" class="area"></div>
        <div id="info-area">
            <div class="leader" onclick="onLeaderClick('enemy')">
                <div style="font-size:20px;">ü§ñ</div>
                <div id="enemy-hp" class="hp-circle">25</div>
            </div>
            <div class="turn-info">
                <div id="turn-display" style="color:#aaa; font-size: 10px;">Turn 1</div>
                <div id="mp-display" class="mp-bar">MP 1/1</div>
            </div>
            <button id="btn-end-turn" onclick="endTurn()">ÁµÇ‰∫Ü</button>
            <div class="leader" onclick="onLeaderClick('player')">
                <div id="player-hp" class="hp-circle">25</div>
                <div style="font-size:20px;">üßë‚Äçüî¨</div>
            </div>
        </div>
        <div id="craftable-list"></div>
        <div id="player-field" class="area"></div>
        <div id="player-hand-area"></div>
        <div id="cancel-attack-btn" style="display: none; position: absolute; top: 60%; left: 50%; transform: translate(-50%, -50%); background: var(--danger); color: white; padding: 10px 20px; border-radius: 20px; font-weight: bold; z-index: 200; cursor: pointer;" onclick="cancelAttack()">‚ùå „Ç≠„É£„É≥„Çª„É´</div>
    </div>

    <div id="result-screen" class="screen hidden">
        <div class="result-content">
            <div class="result-title" id="result-title">VICTORY</div>
            <div class="result-message" id="result-message">Win!</div>
            <div class="menu-btn primary" onclick="showTitle()">OK</div>
        </div>
        <div id="confetti-container"></div>
    </div>

    <div id="card-detail-panel" onclick="hideDetail()">
        <div style="text-align: right; font-size: 24px; cursor: pointer;">√ó</div>
        <div style="text-align: center;">
            <span id="detail-symbol" style="font-size: 24px; font-weight: bold; color: var(--primary);"></span>
            <span id="detail-name" style="font-size: 18px; font-weight: bold; margin-left: 10px;"></span>
            <span id="detail-rarity" style="font-size: 12px; color: var(--accent); margin-left: 5px;"></span>
        </div>
        <div id="detail-art-frame" class="big-art art-frame"><div id="detail-css-art" class="css-art"></div></div>
        <div id="detail-stats" style="display: flex; justify-content: center; gap: 20px; font-size: 18px; font-weight: bold; margin: 10px 0;"></div>
        <div id="detail-skills" style="font-size: 12px; overflow-y: auto; max-height: 150px;"></div>
    </div>

    <div class="action-overlay" id="action-btns" style="display:none;">
        <button class="game-btn btn-draw" onclick="actionDraw()">Ôºã „Éâ„É≠„Éº</button>
        <button class="game-btn btn-syn" onclick="actionSynthesize()">‚öóÔ∏è ÂêàÊàê</button>
    </div>

    <div id="skill-modal" style="display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 4000; flex-direction: column; justify-content: center; align-items: center; padding: 20px;">
        <h3 style="color:white;">ÊäÄ„ÇíÈÅ∏Êäû</h3>
        <div id="skill-list" style="width: 100%; max-width: 300px; display: flex; flex-direction: column; gap: 10px;"></div>
        <button class="game-btn" style="background:#7f8c8d; margin-top:20px;" onclick="closeSkillModal()">„Ç≠„É£„É≥„Çª„É´</button>
    </div>

    <div id="msg-box"></div>

    <script>
        const MAX_HAND = 10; const MAX_FIELD = 5; const INITIAL_HP = 25;

        // „Éá„Éº„ÇøÂÆöÁæ© („Ç¢„Éº„Éà„ÇØ„É©„Çπ„ÇíÊõ¥Êñ∞)
        const ELEM = {
            H: { symbol: 'H', name: 'Ê∞¥Á¥†', rarity: 'N', artClass: 'art-p-fire' },
            He: { symbol: 'He', name: '„Éò„É™„Ç¶„É†', rarity: 'SR', artClass: 'art-p-gas' },
            Li: { symbol: 'Li', name: '„É™„ÉÅ„Ç¶„É†', rarity: 'R', artClass: 'art-p-metal' },
            C: { symbol: 'C', name: 'ÁÇ≠Á¥†', rarity: 'N', artClass: 'art-p-solid' },
            N: { symbol: 'N', name: 'Á™íÁ¥†', rarity: 'N', artClass: 'art-p-gas' },
            O: { symbol: 'O', name: 'ÈÖ∏Á¥†', rarity: 'N', artClass: 'art-p-gas' },
            F: { symbol: 'F', name: '„Éï„ÉÉÁ¥†', rarity: 'SR', artClass: 'art-p-toxic' },
            Ne: { symbol: 'Ne', name: '„Éç„Ç™„É≥', rarity: 'SR', artClass: 'art-p-gas' },
            Na: { symbol: 'Na', name: '„Éä„Éà„É™„Ç¶„É†', rarity: 'N', artClass: 'art-p-metal' },
            Al: { symbol: 'Al', name: '„Ç¢„É´„Éü„Éã„Ç¶„É†', rarity: 'R', artClass: 'art-p-metal' },
            Si: { symbol: 'Si', name: '„Ç±„Ç§Á¥†', rarity: 'R', artClass: 'art-p-solid' },
            S: { symbol: 'S', name: 'Á°´ÈªÑ', rarity: 'R', artClass: 'art-p-toxic' },
            Cl: { symbol: 'Cl', name: 'Â°©Á¥†', rarity: 'N', artClass: 'art-p-toxic' },
            Ar: { symbol: 'Ar', name: '„Ç¢„É´„Ç¥„É≥', rarity: 'SR', artClass: 'art-p-gas' },
            Ca: { symbol: 'Ca', name: '„Ç´„É´„Ç∑„Ç¶„É†', rarity: 'R', artClass: 'art-p-solid' },
            Ti: { symbol: 'Ti', name: '„ÉÅ„Çø„É≥', rarity: 'SR', artClass: 'art-p-metal' },
            Cr: { symbol: 'Cr', name: '„ÇØ„É≠„É†', rarity: 'SR', artClass: 'art-p-metal' },
            Fe: { symbol: 'Fe', name: 'ÈâÑ', rarity: 'N', artClass: 'art-p-metal' },
            Cu: { symbol: 'Cu', name: 'ÈäÖ', rarity: 'N', artClass: 'art-p-metal' },
            Zn: { symbol: 'Zn', name: '‰∫úÈâõ', rarity: 'R', artClass: 'art-p-metal' },
            Ag: { symbol: 'Ag', name: 'ÈäÄ', rarity: 'SR', artClass: 'art-p-metal' },
            Cd: { symbol: 'Cd', name: '„Ç´„Éâ„Éü„Ç¶„É†', rarity: 'R', artClass: 'art-p-toxic' },
            W:  { symbol: 'W', name: '„Çø„É≥„Ç∞„Çπ„ÉÜ„É≥', rarity: 'SSR', artClass: 'art-p-metal' },
            Pt: { symbol: 'Pt', name: '„Éó„É©„ÉÅ„Éä', rarity: 'SSR', artClass: 'art-p-metal' },
            Au: { symbol: 'Au', name: 'Èáë', rarity: 'SSR', artClass: 'art-p-gold' },
            Hg: { symbol: 'Hg', name: 'Ê∞¥ÈäÄ', rarity: 'SR', artClass: 'art-p-liquid' }
        };

        const RECIPES = [
            { ingredients: ['H', 'Cl'], product: { symbol: 'HCl', name: 'Â°©ÂåñÊ∞¥Á¥†', rarity:'R', atk: 5, hp: 1, artClass:'art-p-toxic', skills: [{name:'Âº∑ÈÖ∏ËÖêÈ£ü', power:5, desc:'È´òÁÅ´Âäõ„ÅÆÈÖ∏ÊîªÊíÉ'}] }},
            { ingredients: ['H', 'F'], product: { symbol: 'HF', name: '„Éï„ÉÉÂåñÊ∞¥Á¥†', rarity:'SR', atk: 4, hp: 2, ability:'toxic', artClass:'art-p-toxic', skills: [{name:'„Ç¨„É©„ÇπËÖêÈ£ü', power:4, desc:'ÊîªÊíÉ'}, {name:'ÁåõÊØí', power:0, type:'toxic', desc:'ÂøÖÊÆ∫'}] }},
            { ingredients: ['Na', 'H'], product: { symbol: 'NaH', name: 'Ê∞¥Á¥†ÂåñNa', rarity:'R', atk: 3, hp: 1, ability:'storm', artClass:'art-p-solid', skills: [{name:'ÈÇÑÂÖÉ‰ΩúÁî®', power:3, desc:'ÁñæËµ∞'}] }},
            { ingredients: ['H', 'H', 'O'], product: { symbol: 'H2O', name: 'Ê∞¥', rarity:'N', atk: 1, hp: 4, artClass:'art-p-liquid', skills: [{name:'Ê∞¥ÊµÅ', power:1, desc:'ÊîªÊíÉ'}, {name:'Âä†Ê∞¥ÂàÜËß£', power:3, type:'heal', desc:'HP3ÂõûÂæ©'}] }},
            { ingredients: ['Ag', 'Cl'], product: { symbol: 'AgCl', name: 'Â°©ÂåñÈäÄ', rarity:'SR', atk: 1, hp: 6, ability:'ward', artClass:'art-p-solid', skills: [{name:'ÁôΩËâ≤Ê≤àÊÆø', power:0, type:'guard', desc:'ÂÆàË≠∑'}] }},
            { ingredients: ['Fe', 'O'], product: { symbol: 'FeO', name: 'ÈÖ∏ÂåñÈâÑ(II)', rarity:'N', atk: 3, hp: 5, artClass:'art-p-solid', skills: [{name:'ÈªíÈåÜ', power:3, desc:'ÈÄöÂ∏∏ÊîªÊíÉ'}] }},
            { ingredients: ['Fe', 'O', 'O'], product: { symbol: 'Fe2O3', name: 'Ëµ§ÈåÜ(‰∏çÂãïÊÖã)', rarity:'R', atk: 2, hp: 8, ability:'ward', artClass:'art-p-solid', skills: [{name:'‰∏çÂãïÊÖã', power:2, desc:'È´òËÄê‰πÖ'}] }},
            { ingredients: ['Cu', 'O'], product: { symbol: 'CuO', name: 'ÈÖ∏ÂåñÈäÖ(II)', rarity:'N', atk: 3, hp: 4, artClass:'art-p-solid', skills: [{name:'ÈªíËâ≤Á≤âÊú´', power:3, desc:'ÊîªÊíÉ'}] }},
            { ingredients: ['Zn', 'Cu'], product: { symbol: 'Brass', name: 'ÈªÑÈäÖ', rarity:'R', atk: 4, hp: 5, artClass:'art-p-metal', skills: [{name:'ÂêàÈáë„Ç¢„Çø„ÉÉ„ÇØ', power:4, desc:'ÊîªÊíÉ'}] }},
            { ingredients: ['Hg', 'Zn'], product: { symbol: 'Amalgam', name: '‰∫úÈâõ„Ç¢„Éû„É´„Ç¨„É†', rarity:'SR', atk: 3, hp: 6, ability:'ward', artClass:'art-p-metal', skills: [{name:'„Ç¢„Éû„É´„Ç¨„É†Âåñ', power:3, desc:'ÂÆàË≠∑'}] }},
            { ingredients: ['C', 'O'], product: { symbol: 'CO', name: '‰∏ÄÈÖ∏ÂåñÁÇ≠Á¥†', rarity:'R', atk: 1, hp: 2, ability:'toxic', artClass:'art-p-gas', skills: [{name:'‰∏çÂÆåÂÖ®ÁáÉÁÑº', power:1, desc:'ÊîªÊíÉ'}, {name:'„Éò„É¢„Ç∞„É≠„Éì„É≥ÁµêÂêà', power:0, type:'toxic', desc:'ÂøÖÊÆ∫'}] }},
            { ingredients: ['H', 'S'], product: { symbol: 'H2S', name: 'Á°´ÂåñÊ∞¥Á¥†', rarity:'R', atk: 2, hp: 3, ability:'toxic', artClass:'art-p-gas', skills: [{name:'ËÖêÂçµËá≠', power:2, desc:'ÊîªÊíÉ'}, {name:'Á°´Âåñ', power:0, type:'toxic', desc:'ÂøÖÊÆ∫'}] }},
            { ingredients: ['Cl', 'Cl'], product: { symbol: 'Cl2', name: 'Â°©Á¥†„Ç¨„Çπ', rarity:'R', atk: 3, hp: 3, artClass:'art-p-gas', skills: [{name:'ÈÖ∏Âåñ‰ΩúÁî®', power:3, desc:'ÊîªÊíÉ'}, {name:'ÊØí„Ç¨„ÇπÊï£Â∏É', power:2, type:'aoe', desc:'ÂÖ®‰Ωì2„ÉÄ„É°'}] }},
            { ingredients: ['S', 'O', 'O'], product: { symbol: 'SO2', name: '‰∫åÈÖ∏ÂåñÁ°´ÈªÑ', rarity:'N', atk: 2, hp: 4, artClass:'art-p-gas', skills: [{name:'ÈÖ∏ÊÄßÈõ®', power:1, type:'aoe', desc:'ÂÖ®‰Ωì1„ÉÄ„É°'}] }},
            { ingredients: ['Na', 'O', 'H'], product: { symbol: 'NaOH', name: 'Ê∞¥ÈÖ∏ÂåñNa', rarity:'R', atk: 3, hp: 3, artClass:'art-p-solid', skills: [{name:'ÊΩÆËß£', power:3, desc:'ÊîªÊíÉ'}, {name:'‰∏≠ÂíåÁÜ±', power:2, type:'aoe_heal', desc:'ÂÖ®‰Ωì2„ÉÄ„É°/2ÂõûÂæ©'}] }},
            { ingredients: ['Al', 'O', 'O'], product: { symbol: 'Al2O3', name: '„Ç¢„É´„Éü„Éä', rarity:'R', atk: 2, hp: 7, ability:'ward', artClass:'art-p-solid', skills: [{name:'„Ç¢„É´„Éû„Ç§„Éà', power:2, desc:'ÂÆàË≠∑'}] }},
            { ingredients: ['C', 'C', 'C'], product: { symbol: 'Diamond', name: '„ÉÄ„Ç§„É§„É¢„É≥„Éâ', rarity:'SSR', atk: 4, hp: 10, ability:'ward', artClass:'art-p-gold', skills: [{name:'ÊúÄÂº∑Á°¨Â∫¶', power:4, desc:'ÈâÑÂ£Å'}] }},
            { ingredients: ['Au'], product: { symbol: 'Au', name: 'Èáë', rarity:'SSR', atk: 6, hp: 6, artClass:'art-p-gold', skills: [{name:'‰∏çÂ§â„ÅÆËºù„Åç', power:6, desc:'È´òÁÅ´Âäõ'}] }},
            { ingredients: ['He', 'He'], product: { symbol: 'He', name: '„Éò„É™„Ç¶„É†', rarity:'SR', atk: 2, hp: 2, ability:'stealth', artClass:'art-p-gas', skills: [{name:'‰∏çÊ¥ªÊÄß', power:2, desc:'ÊΩú‰ºè'}] }},
            { ingredients: ['H', 'Cl', 'N', 'O', 'O', 'O'], product: { symbol: 'AquaRegia', name: 'ÁéãÊ∞¥', rarity:'SSR', atk: 0, hp: 0, type:'spell', artClass:'art-p-liquid', skills: [{name:'ÈáëÊ∫∂„Åã„Åó', power:99, type:'toxic', desc:'Á¢∫ÂÆöÈô§Âéª'}] }},
        ];

        const DECKS = {
            aggro: { name: 'Ë∂ÖÈÄüÊîª', elements: ['H', 'H', 'Cl', 'F', 'Na', 'O'], recipes: ['HCl', 'HF', 'NaH', 'H2O'] },
            counter: { name: '„Ç´„Ç¶„É≥„Çø„Éº', elements: ['Ag', 'Cl', 'Fe', 'O', 'Cu', 'Zn', 'Hg'], recipes: ['AgCl', 'FeO', 'Fe2O3', 'Brass', 'Amalgam', 'CuO'] },
            toxic: { name: 'ÂÆ≥ÊÇ™(ÊØí)', elements: ['C', 'O', 'S', 'H', 'Cl', 'Cd'], recipes: ['CO', 'H2S', 'Cl2', 'SO2', 'CdS'] },
            control: { name: '„Ç≥„É≥„Éà„É≠„Éº„É´', elements: ['Al', 'O', 'H', 'Na', 'Cl', 'Ca'], recipes: ['Al2O3', 'NaOH', 'H2O', 'NaCl', 'Ca(OH)2'] },
            gemstone: { name: 'ÂÆùÁü≥', elements: ['C', 'Al', 'O', 'Si', 'Cr', 'Ti'], recipes: ['Diamond', 'Ruby', 'Sapphire', 'SiO2'] },
            heavy: { name: 'ÈáçÈáëÂ±û', elements: ['Au', 'Pt', 'W', 'Ti', 'Fe'], recipes: ['Au', 'Pt', 'W', 'Ti'] },
            noble: { name: 'Ë≤¥„Ç¨„Çπ', elements: ['He', 'He', 'Ne', 'Ne', 'Ar', 'Ar'], recipes: ['He', 'Ne', 'Ar'] },
            hazard: { name: 'Âç±Èô∫Áâ©', elements: ['H', 'Cl', 'N', 'O', 'S', 'K', 'Mn'], recipes: ['AquaRegia', 'H2SO4', 'KMnO4'] }
        };

        let gs = { hp: INITIAL_HP, enemyHp: INITIAL_HP, hand: [], field: [], enemyHand: [], enemyField: [], turn: 1, mp: 1, maxMp: 1, isPlayerTurn: true, selectedHandIds: [], attackingUnit: null };

        window.onload = () => {
            initParticles(); initDeckSelect(); showTitle();
        };

        function initParticles() {
            const container = document.getElementById('particles');
            if(!container) return;
            for(let i=0; i<30; i++) {
                const p = document.createElement('div');
                p.className = 'particle';
                p.style.left = Math.random()*100 + 'vw';
                p.style.width = p.style.height = (Math.random()*5 + 2) + 'px';
                p.style.animationDuration = (Math.random()*10 + 5) + 's';
                p.style.animationDelay = (Math.random()*5) + 's';
                container.appendChild(p);
            }
        }
        function initDeckSelect() {
            const g = document.getElementById('deck-grid-container');
            for(let k in DECKS) {
                const d = document.createElement('div'); d.className='deck-card';
                d.innerHTML = `<div class="deck-title">${DECKS[k].name}</div><div class="deck-desc">${DECKS[k].desc}</div>`;
                d.onclick = () => startGame(k); g.appendChild(d);
            }
        }

        function showTitle() { hideAll(); document.getElementById('title-screen').classList.remove('hidden'); }
        function showDeckSelect() { hideAll(); document.getElementById('deck-select-screen').classList.remove('hidden'); }
        function showGame() { hideAll(); document.getElementById('game-board').style.display='flex'; document.getElementById('action-btns').style.display='flex'; }
        function showResult(isWin) {
            const s=document.getElementById('result-screen'), t=document.getElementById('result-title'), m=document.getElementById('result-message');
            s.classList.remove('hidden');
            if(isWin){t.innerText="VICTORY";t.className="result-title result-win";m.innerText="You Win!";createConfetti();}
            else{t.innerText="DEFEAT";t.className="result-title result-lose";m.innerText="You Lose...";}
        }
        function hideAll() { document.querySelectorAll('.screen').forEach(s=>s.classList.add('hidden')); document.getElementById('game-board').style.display='none'; document.getElementById('action-btns').style.display='none'; document.getElementById('confetti-container').innerHTML=''; }

        function startGame(key) { resetGame(key); showGame(); showMessage("Start!", 2000); updateView(); }
        function resetGame(key) {
            gs.playerPool = DECKS[key].elements.map(s=>ELEM[s]); gs.playerRecipes = RECIPES.filter(r=>DECKS[key].recipes.includes(r.product.symbol));
            const ek = Object.keys(DECKS)[Math.floor(Math.random()*Object.keys(DECKS).length)];
            gs.enemyPool = DECKS[ek].elements.map(s=>ELEM[s]); gs.enemyRecipes = RECIPES.filter(r=>DECKS[ek].recipes.includes(r.product.symbol));
            gs.turn=1; gs.isPlayerTurn=true; gs.mp=1; gs.maxMp=1; gs.hp=INITIAL_HP; gs.enemyHp=INITIAL_HP; gs.hand=[]; gs.field=[]; gs.enemyHand=[]; gs.enemyField=[]; gs.selectedHandIds=[]; gs.attackingUnit=null;
            for(let i=0; i<5; i++) { drawCard(true); drawCard(false); }
            document.getElementById('btn-end-turn').disabled=false;
        }

        function drawCard(isP) {
            const p = isP ? gs.playerPool : gs.enemyPool, h = isP ? gs.hand : gs.enemyHand;
            if(h.length>=MAX_HAND) { if(!isP) h.shift(); else return; }
            const c = { ...p[Math.floor(Math.random()*p.length)], id:Math.random().toString(36), type:'element' };
            h.push(c);
        }
        function actionDraw() { if(!gs.isPlayerTurn||gs.mp<1){showMessage("No MP");return;} gs.mp--; drawCard(true); updateView(); }

        function actionSynthesize() {
            if(!gs.isPlayerTurn||gs.selectedHandIds.length===0) return;
            const sel = gs.hand.filter(c=>gs.selectedHandIds.includes(c.id));
            const sym = sel.map(c=>c.symbol).sort();
            const r = gs.playerRecipes.find(r=>JSON.stringify(r.ingredients.sort())===JSON.stringify(sym));
            if(r) processSynth(r); else { showMessage("Failed"); gs.selectedHandIds=[]; updateView(); }
        }
        function processSynth(r) {
            gs.hand = gs.hand.filter(c=>!gs.selectedHandIds.includes(c.id)); gs.selectedHandIds=[];
            if(r.product.type==='spell') {
                const s = r.product.skills[0];
                if(gs.enemyField.length>0) { const t=gs.enemyField.reduce((a,b)=>a.currentHp>b.currentHp?a:b); showMessage(`${s.name}->${t.name}`); if(s.type==='toxic')t.currentHp=-99;else t.currentHp-=s.power; }
                else { showMessage(`${s.name}->Leader`); gs.enemyHp-=s.power; }
                checkEnd(); updateView(); return;
            }
            if(gs.field.length>=MAX_FIELD){showMessage("Full");return;}
            const u = {...r.product, id:Math.random().toString(36), maxHp:r.product.hp, currentHp:r.product.hp, canAttack:r.product.ability==='storm', type:'unit'};
            gs.field.push(u); showMessage(`Summon: ${u.name}`); updateView();
        }

        function onHandClick(id) { if(!gs.isPlayerTurn)return; const c=gs.hand.find(x=>x.id===id); if(c)showDetail(c); if(gs.selectedHandIds.includes(id))gs.selectedHandIds=gs.selectedHandIds.filter(x=>x!==id);else gs.selectedHandIds.push(id); updateView(); }
        function onFieldClick(id, isP) {
            if(!gs.isPlayerTurn)return;
            if(isP){ const u=gs.field.find(x=>x.id===id); if(u)showDetail(u); if(u&&u.canAttack){gs.attackingUnit=u; updateView();} }
            else if(gs.attackingUnit){ const t=gs.enemyField.find(x=>x.id===id); if(t)showDetail(t); if(t.ability==='stealth'){showMessage("Stealth!");return;} prepareAttack(gs.attackingUnit,t,'unit'); }
            else{ const t=gs.enemyField.find(x=>x.id===id); if(t)showDetail(t); }
        }
        function onLeaderClick(s) { if(!gs.isPlayerTurn||s!=='enemy'||!gs.attackingUnit)return; prepareAttack(gs.attackingUnit,'leader','leader'); }
        function prepareAttack(a, t, type) {
            if(type==='leader'||(type==='unit'&&t.ability!=='ward')){ if(gs.enemyField.some(u=>u.ability==='ward'&&u.ability!=='stealth')){showMessage("Blocked by Ward");return;} }
            if(a.skills.length>1)openSkillModal(a,t); else executeSkill(a,t,a.skills[0]);
        }
        function openSkillModal(a,t){ const m=document.getElementById('skill-modal'), l=document.getElementById('skill-list'); l.innerHTML=''; a.skills.forEach(s=>{ const b=document.createElement('div'); b.className='skill-btn'; b.innerHTML=`${s.name} (${s.power})`; b.onclick=()=>{executeSkill(a,t,s);closeSkillModal();}; l.appendChild(b); }); m.style.display='flex'; }
        function closeSkillModal(){ document.getElementById('skill-modal').style.display='none'; cancelAttack(); }
        function executeSkill(a, t, s) {
            if(s.type==='aoe'){ gs.enemyField.forEach(u=>u.currentHp-=s.power); gs.enemyHp-=s.power; }
            else if(s.type==='aoe_heal'){ gs.enemyField.forEach(u=>u.currentHp-=s.power); gs.hp+=s.power; }
            else if(s.type==='heal'){ gs.hp+=s.power; }
            else {
                let d=s.power; if(t==='leader') gs.enemyHp-=d;
                else { let c=t.atk; if(s.type==='toxic'&&d>0)t.currentHp=-99;else t.currentHp-=d; if(t.currentHp<=0&&t.ability==='toxic'&&c>0)a.currentHp=-99;else a.currentHp-=c; }
            }
            a.canAttack=false; showMessage(`${a.name} attacks!`); cancelAttack(); checkEnd(); updateView();
        }
        function cancelAttack(){ gs.attackingUnit=null; updateView(); }
        function checkEnd(){ gs.field=gs.field.filter(u=>u.currentHp>0); gs.enemyField=gs.enemyField.filter(u=>u.currentHp>0); if(gs.enemyHp<=0)showResult(true);if(gs.hp<=0)showResult(false); updateView(); }
        
        function endTurn(){ if(!gs.isPlayerTurn)return; gs.isPlayerTurn=false; cancelAttack(); document.getElementById('btn-end-turn').disabled=true; showMessage("Enemy Turn"); setTimeout(cpuTurn,1500); }
        async function cpuTurn(){
            if(gs.maxMp<10)gs.maxMp++; gs.mp=gs.maxMp; drawCard(false); updateView(); await sleep(1000);
            let act=true; while(act&&gs.enemyField.length<MAX_FIELD){ act=false; const h=gs.enemyHand.map(c=>c.symbol);
                for(const r of gs.enemyRecipes){ if(r.product.type==='spell')continue; let ing=[...r.ingredients], th=[...h], ok=true;
                    for(const i of ing){ const idx=th.indexOf(i); if(idx===-1){ok=false;break;} th.splice(idx,1); }
                    if(ok){ for(const i of r.ingredients){ const idx=gs.enemyHand.findIndex(c=>c.symbol===i); gs.enemyHand.splice(idx,1); }
                        const u={...r.product,id:Math.random(),maxHp:r.product.hp,currentHp:r.product.hp,canAttack:false,type:'unit'}; gs.enemyField.push(u); showMessage(`CPU: ${u.name}`); await sleep(1000); updateView(); act=true; break; } } }
            gs.enemyField.forEach(u=>u.canAttack=true);
            for(const u of gs.enemyField){ if(!u.canAttack)continue; const g=gs.field.filter(g=>g.ability==='ward'&&g.ability!=='stealth'); let t='leader'; if(g.length>0)t=g[0];
                if(t==='leader'){ gs.hp-=u.skills[0].power; showMessage(`CPU attack Leader`); } else { let d=u.skills[0].power; if(u.skills[0].type==='toxic'&&d>0)t.currentHp=-99;else t.currentHp-=d; u.currentHp-=t.atk; showMessage(`CPU attack ${t.name}`); }
                checkEnd(); updateView(); await sleep(1000); }
            gs.turn++; if(gs.maxMp<10)gs.maxMp++; gs.mp=gs.maxMp; gs.isPlayerTurn=true; document.getElementById('btn-end-turn').disabled=false; gs.field.forEach(u=>u.canAttack=true); drawCard(true); showMessage("Your Turn"); updateView();
        }
        const sleep=m=>new Promise(r=>setTimeout(r,m));

        function updateView() {
            document.getElementById('turn-display').innerText=`Turn ${gs.turn}`; document.getElementById('mp-display').innerText=`MP ${gs.mp}/${gs.maxMp}`;
            document.getElementById('player-hp').innerText=gs.player.hp; document.getElementById('enemy-hp').innerText=gs.enemy.hp;
            document.getElementById('cancel-attack-btn').style.display=gs.attackingUnit?'block':'none';
            render(document.getElementById('player-hand-area'), gs.hand, 'hand', true);
            render(document.getElementById('player-field'), gs.field, 'field', true);
            render(document.getElementById('enemy-field'), gs.enemyField, 'field', false);
            const eh=document.getElementById('enemy-hand-area'); eh.innerHTML=''; gs.enemyHand.forEach(()=>{const d=document.createElement('div');d.className='card';d.style.background='#34495e';d.style.width='30px';d.style.height='45px';eh.appendChild(d);});
            updateHint();
        }

        function showDetail(c) {
            const p=document.getElementById('card-detail-panel'); p.style.display='flex';
            document.getElementById('detail-symbol').innerText=c.symbol; document.getElementById('detail-name').innerText=c.name; document.getElementById('detail-rarity').innerText=c.rarity;
            const a=document.getElementById('detail-css-art'); a.className=`css-art ${c.artClass}`;
            const st=document.getElementById('detail-stats'), sk=document.getElementById('detail-skills'); sk.innerHTML='';
            if(c.type==='element'){ st.innerHTML=`<span style="font-size:14px;color:#ccc">Á¥†Êùê</span>`; sk.innerHTML=`<div>ÂêàÊàê„Å´‰ΩøÁî®„Åó„Åæ„Åô„ÄÇ</div>`; }
            else{ st.innerHTML=`<span style="color:#e67e22">‚öîÔ∏è${c.atk}</span><span style="color:#2ecc71">‚ù§Ô∏è${c.currentHp}</span>`; c.skills.forEach(s=>{ sk.innerHTML+=`<div><b>${s.name}</b> (${s.power}): ${s.desc}</div>`; }); }
        }
        function hideDetail(){document.getElementById('card-detail-panel').style.display='none';}

        function render(el, list, type, isP) {
            el.innerHTML='';
            list.forEach(c=>{
                const d=document.createElement('div'); d.className='card'; d.setAttribute('data-rarity',c.rarity);
                d.onclick=(e)=>{e.stopPropagation(); if(type==='hand')onHandClick(c.id); if(type==='field')onFieldClick(c.id,isP);};
                if(type==='hand'&&gs.selectedHandIds.includes(c.id))d.classList.add('selected');
                if(type==='field'&&c.canAttack&&isP)d.classList.add('can-attack');
                if(type==='field'&&!isP&&gs.attackingUnit&&c.ability!=='stealth'){ const w=gs.enemyField.some(u=>u.ability==='ward'&&u.ability!=='stealth'); if(!w||c.ability==='ward')d.classList.add('valid-target'); }
                
                let badges=''; if(c.ability){ badges+='<div class="card-badges">';
                    if(c.ability==='ward')badges+='<div class="c-badge cb-ward">üõ°Ô∏è</div>'; if(c.ability==='toxic')badges+='<div class="c-badge cb-toxic">‚ò†Ô∏è</div>';
                    if(c.ability==='storm')badges+='<div class="c-badge cb-storm">‚ö°</div>'; if(c.ability==='stealth')badges+='<div class="c-badge cb-stealth">üëÅÔ∏è</div>';
                    badges+='</div>'; }

                let stats=''; if(c.type!=='element') stats=`<div class="card-stats-container"><div class="stat-atk-box">‚öîÔ∏è${c.atk}</div><div class="stat-hp-box">‚ù§Ô∏è${c.currentHp}</div></div>`;
                let text=''; if(c.type!=='element'&&c.skills[0]) text=`<div class="card-text-box"><span class="skill-name-small">${c.skills[0].name}</span></div>`; else text=`<div class="card-text-box" style="justify-content:center;align-items:center;color:#7f8c8d;">Á¥†Êùê</div>`;

                d.innerHTML = `${badges}<div class="card-header"><span class="card-name">${c.name}</span><span class="card-symbol-small">${c.symbol}</span></div>
                               <div class="card-art-container art-frame"><div class="css-art ${c.artClass}"></div></div>
                               ${text}${stats}`;
                el.appendChild(d);
            });
        }

        function updateHint() {
            const l=document.getElementById('craftable-list'); l.innerHTML=''; if(!gs.isPlayerTurn)return;
            gs.playerRecipes.forEach(r=>{ const h=gs.hand.map(c=>c.symbol); let ok=true;
                for(const i of r.ingredients){ const idx=h.indexOf(i); if(idx===-1){ok=false;break;} h.splice(idx,1); }
                if(ok){ const b=document.createElement('div'); b.className='craft-hint-btn';
                    b.innerHTML=`<div style="font-weight:bold;color:var(--accent)">‚ú® ${r.product.name}</div><div style="font-size:10px">‚öîÔ∏è${r.product.atk} ‚ù§Ô∏è${r.product.hp}</div>`;
                    b.onclick=()=>{ gs.selectedHandIds=[]; const th=[...gs.hand]; r.ingredients.forEach(i=>{ const idx=th.findIndex(c=>c.symbol===i); if(idx!==-1){gs.selectedHandIds.push(th[idx].id); th.splice(idx,1);} }); updateView(); };
                    l.appendChild(b); } });
        }
        function showMessage(t,time=1500){const b=document.getElementById('msg-box');b.innerText=t;b.style.opacity=1;setTimeout(()=>b.style.opacity=0,time);}
        function createConfetti(){ const c=document.getElementById('confetti-container'); if(!c)return; c.innerHTML=''; for(let i=0;i<50;i++){ const p=document.createElement('div'); p.className='confetti'; p.style.left=Math.random()*100+'vw'; p.style.backgroundColor=`hsl(${Math.random()*360},100%,50%)`; p.style.animationDuration=(Math.random()*3+2)+'s'; c.appendChild(p); } }
    </script>
</body>
</html>