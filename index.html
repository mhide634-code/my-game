<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Chem-Verse: Fixed</title>
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700;800&family=Orbitron:wght@700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #1a1a1d;
            --accent: #f1c40f;
            --primary: #3498db;
            --danger: #e74c3c;
            --success: #2ecc71;
            --rare-n: #95a5a6;
            --rare-r: #3498db;
            --rare-sr: #9b59b6;
            --rare-ssr: #f1c40f;
        }

        body {
            font-family: 'M PLUS Rounded 1c', sans-serif;
            background-color: var(--bg-color);
            color: white;
            margin: 0;
            user-select: none;
            overflow: hidden;
            -webkit-tap-highlight-color: transparent;
            height: 100vh;
            width: 100vw;
        }

        /* --- ÂÖ±ÈÄö --- */
        .screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            z-index: 100; transition: opacity 0.3s;
        }
        .hidden { display: none !important; opacity: 0; pointer-events: none; }

        /* --- CSS„Ç¢„Éº„Éà (ÁîªÂÉè„Å™„Åó„Ç§„É©„Çπ„Éà) --- */
        .css-art { width: 100%; height: 100%; position: relative; display: flex; justify-content: center; align-items: center; overflow: hidden; }
        
        .art-gas { background: linear-gradient(to top, #89f7fe, #66a6ff); }
        .art-gas::after { content: '‚òÅÔ∏è'; font-size: 24px; filter: drop-shadow(0 0 5px white); animation: float 3s infinite ease-in-out; }
        
        .art-liquid { background: linear-gradient(to bottom, #4facfe, #00f2fe); }
        .art-liquid::after { content: 'üíß'; font-size: 24px; animation: bounce 2s infinite; }
        
        .art-solid { background: linear-gradient(to bottom, #e6b980, #eacda3); }
        .art-solid::after { content: 'ü™®'; font-size: 24px; }
        
        .art-metal { background: linear-gradient(135deg, #f7971e, #ffd200); }
        .art-metal::after { content: '‚ú®'; font-size: 24px; text-shadow: 0 0 5px white; }
        
        .art-toxic { background: linear-gradient(to bottom, #f093fb, #f5576c); }
        .art-toxic::after { content: '‚ò†Ô∏è'; font-size: 24px; filter: drop-shadow(0 0 5px purple); }

        .art-H { background: linear-gradient(to top, #a1c4fd, #c2e9fb); }
        .art-H::after { content: '( ‚Ä¢œâ‚Ä¢ )'; font-size: 14px; color: #555; background: white; padding: 5px; border-radius: 50%; box-shadow: 0 0 10px white; }
        
        .art-Au { background: radial-gradient(circle, #ffd700, #b8860b); }
        .art-Au::after { content: 'üí∞'; font-size: 28px; }

        .art-Cl { background: linear-gradient(to top, #d4fc79, #96e6a1); }
        .art-Cl::after { content: 'ü§¢'; font-size: 24px; }

        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
        @keyframes bounce { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }

        /* --- „Çø„Ç§„Éà„É´ÁîªÈù¢ --- */
        #title-screen { background: radial-gradient(circle at center, #2c3e50 0%, #000000 100%); }
        .game-logo { font-family: 'Orbitron', sans-serif; font-size: 40px; color: var(--accent); text-shadow: 0 0 20px var(--accent); margin-bottom: 10px; text-align: center; }
        .menu-btn { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 15px 40px; border-radius: 30px; font-weight: bold; cursor: pointer; margin: 10px; transition: 0.2s; }
        .menu-btn:active { transform: scale(0.95); background: rgba(255,255,255,0.2); }

        /* --- „Éá„ÉÉ„Ç≠ÈÅ∏Êäû --- */
        #deck-select-screen { padding: 20px; box-sizing: border-box; display: block; overflow-y: auto; }
        .deck-header { text-align: center; font-size: 20px; margin-bottom: 20px; color: var(--accent); }
        .deck-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding-bottom: 60px; }
        .deck-card { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); padding: 15px; border-radius: 12px; cursor: pointer; min-height: 100px; display: flex; flex-direction: column; justify-content: space-between; }
        .deck-title { font-weight: bold; color: var(--accent); margin-bottom: 5px; }
        .deck-desc { font-size: 10px; color: #ccc; }
        .back-btn { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: #333; padding: 10px 30px; border-radius: 20px; z-index: 200; }

        /* --- „Ç≤„Éº„É†„Éú„Éº„Éâ --- */
        #game-board { display: none; flex-direction: column; height: 100vh; position: relative; background: #111; }
        
        #enemy-hand-area { height: 10%; background: rgba(0,0,0,0.3); display: flex; justify-content: center; align-items: center; gap: 2px; }
        #enemy-field { height: 23%; border-bottom: 2px solid rgba(255,255,255,0.1); display: flex; justify-content: center; align-items: center; }
        
        #info-area {
            height: 12%; background: rgba(20,20,30,0.9);
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 10px; z-index: 10; border-top: 1px solid #333; border-bottom: 1px solid #333;
        }

        #player-field { height: 23%; border-top: 2px solid rgba(255,255,255,0.1); display: flex; justify-content: center; align-items: center; }
        
        #player-hand-area { 
            height: 32%; background: rgba(0,0,0,0.2);
            overflow-x: auto; display: flex; align-items: center; 
            padding-left: 10px; gap: 8px;
        }

        /* --- „Ç´„Éº„Éâ --- */
        .card {
            width: 70px; height: 100px; background: #222; color: #fff;
            border-radius: 8px; position: relative; flex-shrink: 0;
            box-shadow: 0 4px 8px rgba(0,0,0,0.5); border: 2px solid #555;
            transition: transform 0.1s; overflow: hidden;
        }
        .card[data-rarity="N"] { border-color: var(--rare-n); }
        .card[data-rarity="R"] { border-color: var(--rare-r); box-shadow: 0 0 5px var(--rare-r); }
        .card[data-rarity="SR"] { border-color: var(--rare-sr); box-shadow: 0 0 8px var(--rare-sr); }
        .card[data-rarity="SSR"] { border-color: var(--rare-ssr); box-shadow: 0 0 10px var(--rare-ssr); animation: holo 3s infinite linear; }
        @keyframes holo { 0% { filter: brightness(1); } 50% { filter: brightness(1.3); } 100% { filter: brightness(1); } }

        .card-art-area { width: 100%; height: 55%; position: relative; }
        .card-info-area { height: 45%; background: rgba(30,30,30,0.95); padding: 2px; display: flex; flex-direction: column; justify-content: space-between; }
        
        .card-symbol { font-size: 14px; font-weight: bold; color: var(--primary); text-align: center; text-shadow: 0 0 2px black; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 2; display: none; }
        .card-name { font-size: 9px; text-align: center; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-weight: bold; }
        
        .stats { display: flex; justify-content: space-between; padding: 0 2px; font-weight: bold; font-size: 10px; margin-bottom: 2px; }
        .stat-atk { color: #e67e22; } .stat-hp { color: #2ecc71; }

        .ability-container { position: absolute; top: 2px; right: 2px; display: flex; gap: 1px; z-index: 5; }
        .badge { width: 16px; height: 16px; border-radius: 50%; font-size: 10px; display: flex; align-items: center; justify-content: center; border: 1px solid white; box-shadow: 0 1px 2px rgba(0,0,0,0.5); }
        .badge-ward { background: #3498db; } .badge-toxic { background: #8e44ad; } .badge-storm { background: #f1c40f; } .badge-stealth { background: #95a5a6; }

        .card.selected { transform: translateY(-15px); border-color: var(--accent); box-shadow: 0 0 15px var(--accent); z-index: 10; }
        .card.can-attack { border-color: var(--success); box-shadow: 0 0 10px var(--success); }
        .card.attacking { transform: scale(1.2); border-color: var(--danger); box-shadow: 0 0 20px var(--danger); z-index: 100; }

        /* UI */
        .leader { text-align: center; width: 70px; }
        .leader-name { font-size: 10px; color: var(--accent); font-weight: bold; }
        .hp-circle { width: 38px; height: 38px; line-height: 38px; border-radius: 50%; background: linear-gradient(135deg, #c0392b, #900); border: 2px solid white; font-weight: bold; margin: 0 auto; box-shadow: 0 0 5px red; font-size: 16px; }
        
        .action-overlay { position: absolute; bottom: 35%; right: 10px; display: flex; flex-direction: column; gap: 10px; z-index: 50; }
        .game-btn { padding: 10px 16px; border-radius: 20px; border: none; font-weight: bold; color: white; font-size: 12px; box-shadow: 0 4px 8px rgba(0,0,0,0.5); cursor: pointer; }
        .btn-draw { background: linear-gradient(to right, #27ae60, #2ecc71); } 
        .btn-syn { background: linear-gradient(to right, #f39c12, #e67e22); color: #222; }
        #btn-end-turn { padding: 6px 12px; font-size: 11px; background: #e67e22; border-radius: 15px; border: none; color: white; font-weight: bold; }
        #btn-end-turn:disabled { background: #555; color: #888; }

        #cancel-btn { display: none; position: absolute; top: 60%; left: 50%; transform: translate(-50%, -50%); background: var(--danger); color: white; padding: 10px 20px; border-radius: 20px; font-weight: bold; z-index: 200; box-shadow: 0 0 10px var(--danger); cursor: pointer; }

        /* Ë©≥Á¥∞„Éë„Éç„É´ */
        #detail-panel { position: absolute; top: 15%; left: 50%; transform: translateX(-50%); width: 85%; max-width: 320px; background: rgba(20,20,30,0.95); border: 2px solid var(--accent); border-radius: 12px; padding: 20px; display: none; flex-direction: column; color: white; z-index: 3000; box-shadow: 0 0 30px rgba(0,0,0,0.8); }
        .detail-close { position: absolute; top: 5px; right: 10px; font-size: 24px; cursor: pointer; color: #aaa; }
        .detail-sym { font-size: 40px; font-weight: bold; color: var(--primary); text-align: center; }
        .detail-name { font-size: 18px; font-weight: bold; text-align: center; margin-bottom: 5px; }
        .skill-item { margin-bottom: 10px; border-left: 3px solid var(--accent); padding-left: 10px; background: rgba(255,255,255,0.05); padding: 8px; }
        
        #craftable-list { position: absolute; bottom: 38%; left: 10px; display: flex; flex-direction: column; gap: 5px; z-index: 40; pointer-events: none; }
        .craft-btn { background: rgba(0,0,0,0.9); border: 1px solid var(--accent); color: white; padding: 8px 12px; border-radius: 8px; pointer-events: auto; display: flex; flex-direction: column; min-width: 120px; box-shadow: 0 0 5px var(--accent); font-size: 12px; }

        #skill-modal { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 4000; flex-direction: column; justify-content: center; align-items: center; padding: 20px; }
        .skill-btn { background: white; color: #333; padding: 15px; border-radius: 8px; border-left: 8px solid var(--primary); width: 100%; max-width: 300px; margin-bottom: 10px; font-weight: bold; cursor: pointer; }

        #msg-box { position: absolute; top: 40%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.9); padding: 15px 30px; border: 2px solid white; border-radius: 10px; font-weight: bold; font-size: 20px; pointer-events: none; opacity: 0; transition: 0.3s; z-index: 5000; white-space: nowrap; }

        /* „É™„Ç∂„É´„Éà */
        #result-screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 6000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .result-title { font-size: 48px; font-weight: bold; margin-bottom: 20px; font-family: 'Orbitron', sans-serif; }
        .res-win { color: var(--accent); text-shadow: 0 0 20px var(--accent); }
        .res-lose { color: var(--danger); text-shadow: 0 0 20px var(--danger); }

    </style>
</head>
<body>

    <div id="title-screen" class="screen">
        <div class="game-logo">ÁÑ°Ê©üÂåñÂ≠¶<br>„Ç´„Éº„Éâ„Ç≤„Éº„É†</div>
        <div class="menu-btn" style="background: linear-gradient(90deg, #3498db, #2980b9); border:none;" onclick="showDeckSelect()">CPUÂØæÊà¶</div>
        <div class="menu-btn" style="opacity:0.5">ÂØæ‰∫∫Êà¶ (Ê∫ñÂÇô‰∏≠)</div>
        <div class="menu-btn" style="opacity:0.5">„Ç´„Éº„ÉâÂõ≥Èëë (Ê∫ñÂÇô‰∏≠)</div>
    </div>

    <div id="deck-select-screen" class="screen hidden">
        <div class="deck-header">„Éá„ÉÉ„Ç≠„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>
        <div class="deck-grid" id="deck-grid"></div>
        <div class="back-btn menu-btn" onclick="showTitle()">Êàª„Çã</div>
    </div>

    <div id="game-board">
        <div id="enemy-hand-area"></div>
        <div id="enemy-field"></div>
        <div id="info-area">
            <div class="leader" onclick="attackLeader('enemy')">
                <div class="avatar">ü§ñ</div>
                <div class="leader-name" id="enemy-name">CPU</div>
                <div id="enemy-hp" class="hp-circle">25</div>
            </div>
            <div style="text-align:center">
                <div id="turn-display" style="font-size:12px; color:#aaa;">„Çø„Éº„É≥1</div>
                <div id="mp-display" style="font-size:14px; font-weight:bold; color:var(--success);">MP 1/1</div>
            </div>
            <button id="btn-end-turn" onclick="endTurn()">„Çø„Éº„É≥ÁµÇ‰∫Ü</button>
            <div class="leader" onclick="attackLeader('player')">
                <div id="player-hp" class="hp-circle">25</div>
                <div class="leader-name">„ÅÇ„Å™„Åü</div>
                <div class="avatar">üßë‚Äçüî¨</div>
            </div>
        </div>
        <div id="craftable-list"></div>
        <div id="player-field"></div>
        <div id="player-hand-area"></div>
        <div id="cancel-btn" onclick="cancelAttack()">‚ùå ÊîªÊíÉ„Ç≠„É£„É≥„Çª„É´</div>
    </div>

    <div class="action-overlay" id="action-btns" style="display:none;">
        <button class="game-btn btn-draw" onclick="actionDraw()">Ôºã „Éâ„É≠„Éº</button>
        <button class="game-btn btn-syn" onclick="actionSynthesize()">‚öóÔ∏è ÂêàÊàê</button>
    </div>

    <div id="detail-panel" onclick="this.style.display='none'">
        <div class="detail-close">√ó</div>
        <div class="detail-sym" id="det-sym"></div>
        <div class="detail-name" id="det-name"></div>
        <div style="text-align:center; margin-bottom:10px; font-weight:bold; font-size:16px;" id="det-stats"></div>
        <div style="font-size:12px; color:#ccc; max-height:200px; overflow-y:auto;" id="det-skills"></div>
        <div style="text-align:center; margin-top:15px; font-size:10px; color:#666;">(„Çø„ÉÉ„Éó„Åó„Å¶Èñâ„Åò„Çã)</div>
    </div>

    <div id="skill-modal">
        <h3>ÊäÄ„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</h3>
        <div id="skill-list" style="width:100%; display:flex; flex-direction:column; align-items:center;"></div>
        <button class="game-btn" style="background:#7f8c8d; margin-top:20px;" onclick="document.getElementById('skill-modal').style.display='none'; cancelAttack();">„Ç≠„É£„É≥„Çª„É´</button>
    </div>

    <div id="result-screen" class="hidden">
        <div class="result-title" id="res-title">VICTORY</div>
        <div style="margin-bottom:30px; font-weight:bold;" id="res-msg">ÂãùÂà©ÔºÅ</div>
        <div class="menu-btn" onclick="showTitle()">„Çø„Ç§„Éà„É´„Å∏Êàª„Çã</div>
    </div>

    <div id="msg-box"></div>

    <script>
        // --- „Éá„Éº„ÇøÂÆöÁæ© (CSS„Ç¢„Éº„Éà„ÇØ„É©„Çπ‰ªò„Åç) ---
        const ELEM = {
            H: { symbol: 'H', name: 'Ê∞¥Á¥†', rarity: 'N', css: 'art-H' },
            He: { symbol: 'He', name: '„Éò„É™„Ç¶„É†', rarity: 'SR', css: 'art-gas' },
            Li: { symbol: 'Li', name: '„É™„ÉÅ„Ç¶„É†', rarity: 'R', css: 'art-metal' },
            B: { symbol: 'B', name: '„Éõ„Ç¶Á¥†', rarity: 'R', css: 'art-solid' },
            C: { symbol: 'C', name: 'ÁÇ≠Á¥†', rarity: 'N', css: 'art-solid' },
            N: { symbol: 'N', name: 'Á™íÁ¥†', rarity: 'N', css: 'art-gas' },
            O: { symbol: 'O', name: 'ÈÖ∏Á¥†', rarity: 'N', css: 'art-gas' },
            F: { symbol: 'F', name: '„Éï„ÉÉÁ¥†', rarity: 'SR', css: 'art-toxic' },
            Ne: { symbol: 'Ne', name: '„Éç„Ç™„É≥', rarity: 'SR', css: 'art-gas' },
            Na: { symbol: 'Na', name: '„Éä„Éà„É™„Ç¶„É†', rarity: 'N', css: 'art-metal' },
            Mg: { symbol: 'Mg', name: '„Éû„Ç∞„Éç„Ç∑„Ç¶„É†', rarity: 'R', css: 'art-metal' },
            Al: { symbol: 'Al', name: '„Ç¢„É´„Éü„Éã„Ç¶„É†', rarity: 'R', css: 'art-metal' },
            Si: { symbol: 'Si', name: '„Ç±„Ç§Á¥†', rarity: 'R', css: 'art-solid' },
            P: { symbol: 'P', name: '„É™„É≥', rarity: 'R', css: 'art-solid' },
            S: { symbol: 'S', name: 'Á°´ÈªÑ', rarity: 'R', css: 'art-solid' },
            Cl: { symbol: 'Cl', name: 'Â°©Á¥†', rarity: 'N', css: 'art-Cl' },
            Ar: { symbol: 'Ar', name: '„Ç¢„É´„Ç¥„É≥', rarity: 'SR', css: 'art-gas' },
            K: { symbol: 'K', name: '„Ç´„É™„Ç¶„É†', rarity: 'N', css: 'art-metal' },
            Ca: { symbol: 'Ca', name: '„Ç´„É´„Ç∑„Ç¶„É†', rarity: 'R', css: 'art-metal' },
            Ti: { symbol: 'Ti', name: '„ÉÅ„Çø„É≥', rarity: 'SR', css: 'art-metal' },
            Cr: { symbol: 'Cr', name: '„ÇØ„É≠„É†', rarity: 'SR', css: 'art-metal' },
            Mn: { symbol: 'Mn', name: '„Éû„É≥„Ç¨„É≥', rarity: 'R', css: 'art-metal' },
            Fe: { symbol: 'Fe', name: 'ÈâÑ', rarity: 'N', css: 'art-metal' },
            Ni: { symbol: 'Ni', name: '„Éã„ÉÉ„Ç±„É´', rarity: 'R', css: 'art-metal' },
            Cu: { symbol: 'Cu', name: 'ÈäÖ', rarity: 'N', css: 'art-metal' },
            Zn: { symbol: 'Zn', name: '‰∫úÈâõ', rarity: 'R', css: 'art-metal' },
            Ag: { symbol: 'Ag', name: 'ÈäÄ', rarity: 'SR', css: 'art-metal' },
            Cd: { symbol: 'Cd', name: '„Ç´„Éâ„Éü„Ç¶„É†', rarity: 'R', css: 'art-toxic' },
            Sn: { symbol: 'Sn', name: '„Çπ„Ç∫', rarity: 'R', css: 'art-metal' },
            Ba: { symbol: 'Ba', name: '„Éê„É™„Ç¶„É†', rarity: 'R', css: 'art-metal' },
            W:  { symbol: 'W', name: '„Çø„É≥„Ç∞„Çπ„ÉÜ„É≥', rarity: 'SSR', css: 'art-metal' },
            Pt: { symbol: 'Pt', name: '„Éó„É©„ÉÅ„Éä', rarity: 'SSR', css: 'art-metal' },
            Au: { symbol: 'Au', name: 'Èáë', rarity: 'SSR', css: 'art-Au' },
            Hg: { symbol: 'Hg', name: 'Ê∞¥ÈäÄ', rarity: 'SR', css: 'art-liquid' },
            Pb: { symbol: 'Pb', name: 'Èâõ', rarity: 'R', css: 'art-metal' }
        };

        const RECIPES = [
            { ingredients: ['H', 'Cl'], product: { symbol: 'HCl', name: 'Â°©ÂåñÊ∞¥Á¥†', rarity:'R', atk: 5, hp: 1, css:'art-toxic', skills: [{name:'Âº∑ÈÖ∏ËÖêÈ£ü', power:5, desc:'È´òÁÅ´ÂäõÊîªÊíÉ'}] }},
            { ingredients: ['H', 'F'], product: { symbol: 'HF', name: '„Éï„ÉÉÂåñÊ∞¥Á¥†', rarity:'SR', atk: 4, hp: 2, ability:'toxic', css:'art-toxic', skills: [{name:'„Ç¨„É©„ÇπËÖêÈ£ü', power:4, desc:'ÊîªÊíÉ'}, {name:'ÁåõÊØí', power:0, type:'toxic', desc:'ÂøÖÊÆ∫'}] }},
            { ingredients: ['Na', 'H'], product: { symbol: 'NaH', name: 'Ê∞¥Á¥†ÂåñNa', rarity:'R', atk: 3, hp: 1, ability:'storm', css:'art-solid', skills: [{name:'ÈÇÑÂÖÉ‰ΩúÁî®', power:3, desc:'ÁñæËµ∞'}] }},
            { ingredients: ['H', 'H', 'O'], product: { symbol: 'H2O', name: 'Ê∞¥', rarity:'N', atk: 1, hp: 4, css:'art-liquid', skills: [{name:'Ê∞¥ÊµÅ', power:1, desc:'ÊîªÊíÉ'}, {name:'Âä†Ê∞¥ÂàÜËß£', power:3, type:'heal', desc:'HP3ÂõûÂæ©'}] }},
            { ingredients: ['Ag', 'Cl'], product: { symbol: 'AgCl', name: 'Â°©ÂåñÈäÄ', rarity:'SR', atk: 1, hp: 6, ability:'ward', css:'art-solid', skills: [{name:'ÁôΩËâ≤Ê≤àÊÆø', power:0, type:'guard', desc:'ÂÆàË≠∑'}] }},
            { ingredients: ['Fe', 'O'], product: { symbol: 'FeO', name: 'ÈÖ∏ÂåñÈâÑ(II)', rarity:'N', atk: 3, hp: 5, css:'art-solid', skills: [{name:'ÈªíÈåÜ', power:3, desc:'ÈÄöÂ∏∏ÊîªÊíÉ'}] }},
            { ingredients: ['Fe', 'O', 'O'], product: { symbol: 'Fe2O3', name: 'Ëµ§ÈåÜ', rarity:'R', atk: 2, hp: 8, ability:'ward', css:'art-solid', skills: [{name:'‰∏çÂãïÊÖã', power:2, desc:'È´òËÄê‰πÖ'}] }},
            { ingredients: ['Cu', 'O'], product: { symbol: 'CuO', name: 'ÈÖ∏ÂåñÈäÖ(II)', rarity:'N', atk: 3, hp: 4, css:'art-solid', skills: [{name:'ÈªíËâ≤Á≤âÊú´', power:3, desc:'ÊîªÊíÉ'}] }},
            { ingredients: ['Zn', 'Cu'], product: { symbol: 'Brass', name: 'ÈªÑÈäÖ', rarity:'R', atk: 4, hp: 5, css:'art-metal', skills: [{name:'ÂêàÈáë„Ç¢„Çø„ÉÉ„ÇØ', power:4, desc:'ÊîªÊíÉ'}] }},
            { ingredients: ['Hg', 'Zn'], product: { symbol: 'Amalgam', name: '‰∫úÈâõ„Ç¢„Éû„É´„Ç¨„É†', rarity:'SR', atk: 3, hp: 6, ability:'ward', css:'art-metal', skills: [{name:'„Ç¢„Éû„É´„Ç¨„É†Âåñ', power:3, desc:'ÂÆàË≠∑'}] }},
            { ingredients: ['C', 'O'], product: { symbol: 'CO', name: '‰∏ÄÈÖ∏ÂåñÁÇ≠Á¥†', rarity:'R', atk: 1, hp: 2, ability:'toxic', css:'art-gas', skills: [{name:'‰∏çÂÆåÂÖ®ÁáÉÁÑº', power:1, desc:'ÊîªÊíÉ'}, {name:'„Éò„É¢„Ç∞„É≠„Éì„É≥ÁµêÂêà', power:0, type:'toxic', desc:'ÂøÖÊÆ∫'}] }},
            { ingredients: ['H', 'S'], product: { symbol: 'H2S', name: 'Á°´ÂåñÊ∞¥Á¥†', rarity:'R', atk: 2, hp: 3, ability:'toxic', css:'art-gas', skills: [{name:'ËÖêÂçµËá≠', power:2, desc:'ÊîªÊíÉ'}, {name:'Á°´Âåñ', power:0, type:'toxic', desc:'ÂøÖÊÆ∫'}] }},
            { ingredients: ['Cl', 'Cl'], product: { symbol: 'Cl2', name: 'Â°©Á¥†„Ç¨„Çπ', rarity:'R', atk: 3, hp: 3, css:'art-gas', skills: [{name:'ÈÖ∏Âåñ‰ΩúÁî®', power:3, desc:'ÊîªÊíÉ'}, {name:'ÊØí„Ç¨„ÇπÊï£Â∏É', power:2, type:'aoe', desc:'ÂÖ®‰Ωì2„ÉÄ„É°'}] }},
            { ingredients: ['S', 'O', 'O'], product: { symbol: 'SO2', name: '‰∫åÈÖ∏ÂåñÁ°´ÈªÑ', rarity:'N', atk: 2, hp: 4, css:'art-gas', skills: [{name:'ÈÖ∏ÊÄßÈõ®', power:1, type:'aoe', desc:'ÂÖ®‰Ωì1„ÉÄ„É°'}] }},
            { ingredients: ['Na', 'O', 'H'], product: { symbol: 'NaOH', name: 'Ê∞¥ÈÖ∏ÂåñNa', rarity:'R', atk: 3, hp: 3, css:'art-solid', skills: [{name:'ÊΩÆËß£', power:3, desc:'ÊîªÊíÉ'}, {name:'‰∏≠ÂíåÁÜ±', power:2, type:'aoe_heal', desc:'ÂÖ®‰Ωì2„ÉÄ„É°/2ÂõûÂæ©'}] }},
            { ingredients: ['Al', 'O', 'O'], product: { symbol: 'Al2O3', name: '„Ç¢„É´„Éü„Éä', rarity:'R', atk: 2, hp: 7, ability:'ward', css:'art-solid', skills: [{name:'„Ç¢„É´„Éû„Ç§„Éà', power:2, desc:'ÂÆàË≠∑'}] }},
            { ingredients: ['C', 'C', 'C'], product: { symbol: 'Diamond', name: '„ÉÄ„Ç§„É§„É¢„É≥„Éâ', rarity:'SSR', atk: 4, hp: 10, ability:'ward', css:'art-Au', skills: [{name:'ÊúÄÂº∑Á°¨Â∫¶', power:4, desc:'ÈâÑÂ£Å'}] }},
            { ingredients: ['Au'], product: { symbol: 'Au', name: 'Èáë', rarity:'SSR', atk: 6, hp: 6, css:'art-Au', skills: [{name:'‰∏çÂ§â„ÅÆËºù„Åç', power:6, desc:'È´òÁÅ´Âäõ'}] }},
            { ingredients: ['He', 'He'], product: { symbol: 'He', name: '„Éò„É™„Ç¶„É†', rarity:'SR', atk: 2, hp: 2, ability:'stealth', css:'art-gas', skills: [{name:'‰∏çÊ¥ªÊÄß', power:2, desc:'ÊΩú‰ºè'}] }},
            { ingredients: ['H', 'Cl', 'N', 'O', 'O', 'O'], product: { symbol: 'AquaRegia', name: 'ÁéãÊ∞¥', rarity:'SSR', atk: 0, hp: 0, type:'spell', css:'art-liquid', skills: [{name:'ÈáëÊ∫∂„Åã„Åó', power:99, type:'toxic', desc:'Á¢∫ÂÆöÈô§Âéª'}] }},
        ];

        const DECKS = {
            aggro: { name: 'Ë∂ÖÈÄüÊîª', desc: '‰Ωé„Ç≥„Çπ„ÉàÈ´òÁÅ´Âäõ', elements: ['H', 'H', 'Cl', 'F', 'Na', 'O'], recipes: ['HCl', 'HF', 'NaH', 'H2O'] },
            counter: { name: '„Ç´„Ç¶„É≥„Çø„Éº', desc: 'ÂÆà„Å£„Å¶ÂèçÊíÉ', elements: ['Ag', 'Cl', 'Fe', 'O', 'Cu', 'Zn', 'Hg'], recipes: ['AgCl', 'FeO', 'Fe2O3', 'Brass', 'Amalgam', 'CuO'] },
            toxic: { name: 'ÂÆ≥ÊÇ™ÊØí', desc: 'ÂøÖÊÆ∫„ÅßÂç≥Ê≠ª', elements: ['C', 'O', 'S', 'H', 'Cl'], recipes: ['CO', 'H2S', 'Cl2', 'SO2'] },
            control: { name: '„Ç≥„É≥„Éà„É≠„Éº„É´', desc: 'ÂõûÂæ©„Å®ÊîØÈÖç', elements: ['Al', 'O', 'H', 'Na', 'Cl'], recipes: ['Al2O3', 'NaOH', 'H2O', 'NaCl'] },
            gemstone: { name: 'ÂÆùÁü≥', desc: 'ÊúÄÂº∑„ÅÆÁ°¨Â∫¶', elements: ['C', 'C', 'C'], recipes: ['Diamond'] },
            heavy: { name: 'ÈáçÈáëÂ±û', desc: 'ÂæåÂçäÊúÄÂº∑', elements: ['Au', 'Pt', 'W'], recipes: ['Au'] },
            noble: { name: 'Ë≤¥„Ç¨„Çπ', desc: 'ÊΩú‰ºèÊîªÊíÉ', elements: ['He', 'He', 'Ne', 'Ne'], recipes: ['He'] },
            hazard: { name: 'Âç±Èô∫Áâ©', desc: 'Èô§Âéª„Çπ„Éö„É´', elements: ['H', 'Cl', 'N', 'O', 'S'], recipes: ['AquaRegia'] }
        };

        let gs = { hp:25, enemyHp:25, hand:[], field:[], enemyHand:[], enemyField:[], turn:1, mp:1, maxMp:1, isPlayerTurn:true, selected:[], attacker:null };

        // --- ÂàùÊúüÂåñ ---
        window.onload = () => {
            const grid = document.getElementById('deck-grid');
            for(let key in DECKS) {
                const d = document.createElement('div'); d.className='deck-card';
                d.innerHTML = `<div class="deck-title">${DECKS[key].name}</div><div class="deck-desc">${DECKS[key].desc}</div>`;
                d.onclick = () => startGame(key);
                grid.appendChild(d);
            }
            showTitle();
        };

        function showTitle() { hideAll(); document.getElementById('title-screen').style.display='flex'; }
        function showDeckSelect() { hideAll(); document.getElementById('deck-select-screen').style.display='block'; }
        function hideAll() { 
            document.querySelectorAll('.screen').forEach(e=>e.style.display='none'); 
            document.getElementById('game-board').style.display='none'; 
            document.getElementById('action-btns').style.display='none'; 
            document.getElementById('result-screen').style.display='none';
        }

        function startGame(key) {
            gs = { hp:25, enemyHp:25, hand:[], field:[], enemyHand:[], enemyField:[], turn:1, mp:1, maxMp:1, isPlayerTurn:true, selected:[], attacker:null };
            gs.playerPool = DECKS[key].elements.map(s => ELEM[s]);
            // ‚òÖ‰øÆÊ≠£ÁÇπ: „Éó„É¨„Ç§„É§„ÉºÁî®„É¨„Ç∑„Éî„Å®ÊïµÁî®„É¨„Ç∑„Éî„ÇíÂàÜ„Åë„Çã
            gs.playerRecipes = RECIPES.filter(r => DECKS[key].recipes.includes(r.product.symbol));

            // CPU Random
            const cpuKey = Object.keys(DECKS)[Math.floor(Math.random()*Object.keys(DECKS).length)];
            gs.enemyPool = DECKS[cpuKey].elements.map(s=>ELEM[s]);
            gs.enemyRecipes = RECIPES.filter(r => DECKS[cpuKey].recipes.includes(r.product.symbol));
            
            document.getElementById('enemy-name').innerText = `CPU (${DECKS[cpuKey].name})`;

            hideAll();
            document.getElementById('game-board').style.display='flex';
            document.getElementById('action-btns').style.display='flex';
            
            for(let i=0; i<5; i++) { draw(true); draw(false); }
            updateView();
            msg("„Éê„Éà„É´ÈñãÂßãÔºÅ");
        }

        function draw(isPlayer) {
            const pool = isPlayer ? gs.playerPool : gs.enemyPool;
            const card = { ...pool[Math.floor(Math.random()*pool.length)], id: Math.random(), type:'element' };
            if(isPlayer) { if(gs.hand.length<10) gs.hand.push(card); }
            else { if(gs.enemyHand.length<10) gs.enemyHand.push(card); }
        }

        function actionDraw() {
            if(!gs.isPlayerTurn || gs.mp<1) { msg("MP‰∏çË∂≥"); return; }
            gs.mp--; draw(true); updateView();
        }

        function actionSynthesize() {
            if(!gs.isPlayerTurn || gs.selected.length<1) return;
            const sel = gs.hand.filter(c=>gs.selected.includes(c.id));
            const syms = sel.map(c=>c.symbol).sort();
            // ‚òÖ‰øÆÊ≠£ÁÇπ: gs.playerRecipes„Çí‰Ωø„ÅÜ
            const rec = gs.playerRecipes.find(r=>JSON.stringify(r.ingredients.sort())===JSON.stringify(syms));
            if(rec) processSynth(rec);
            else { msg("ÂèçÂøú„Åó„Åæ„Åõ„Çì"); gs.selected=[]; updateView(); }
        }

        function processSynth(rec) {
            // „Çπ„Éö„É´
            if(rec.product.type==='spell') {
                gs.hand = gs.hand.filter(c=>!gs.selected.includes(c.id)); gs.selected=[];
                // Á∞°ÊòìÂäπÊûú
                if(gs.enemyField.length>0) { gs.enemyField[0].currentHp-=99; msg("Êïµ„ÇíÁ†¥Â£äÔºÅ"); }
                else { gs.enemyHp-=5; msg("„É™„Éº„ÉÄ„Éº„Å´„ÉÄ„É°„Éº„Ç∏ÔºÅ"); }
                checkEnd(); updateView(); return;
            }
            if(gs.field.length>=MAX_FIELD) { msg("Ê∫ÄÂì°„Åß„Åô"); return; }
            gs.hand = gs.hand.filter(c=>!gs.selected.includes(c.id)); gs.selected=[];
            const u = { ...rec.product, id:Math.random(), maxHp:rec.product.hp, currentHp:rec.product.hp, canAttack:rec.product.ability==='storm', type:'unit' };
            gs.field.push(u);
            msg("Âè¨ÂñöÔºÅ"); updateView();
        }

        function onHandClick(id) {
            if(!gs.isPlayerTurn) return;
            const c = gs.hand.find(x=>x.id===id); showDetail(c);
            if(gs.selected.includes(id)) gs.selected = gs.selected.filter(x=>x!==id);
            else gs.selected.push(id);
            updateView();
        }

        function onFieldClick(id, isPlayer) {
            if(!gs.isPlayerTurn) return;
            if(isPlayer) {
                const u = gs.field.find(x=>x.id===id); showDetail(u);
                if(u && u.canAttack) { gs.attacker = u; document.body.classList.add('targeting'); updateView(); }
            } else if(gs.attacker) {
                const target = gs.enemyField.find(x=>x.id===id);
                if(target.ability==='stealth') { msg("ÊΩú‰ºè‰∏≠ÔºÅ"); return; }
                prepareAttack(gs.attacker, target, 'unit');
            } else {
                const u = gs.enemyField.find(x=>x.id===id); showDetail(u);
            }
        }

        function attackLeader(side) {
            if(side==='enemy' && gs.attacker) prepareAttack(gs.attacker, 'leader', 'leader');
        }

        function prepareAttack(atk, tgt, type) {
            if(type==='leader' || (type==='unit' && tgt.ability!=='ward')) {
                const guards = gs.enemyField.filter(u=>u.ability==='ward' && u.ability!=='stealth');
                if(guards.length>0) { msg("ÂÆàË≠∑„Å´Èòª„Åæ„Çå„ÅüÔºÅ"); cancelAttack(); return; }
            }
            if(atk.skills.length>1) openSkillModal(atk, tgt);
            else executeSkill(atk, tgt, atk.skills[0]);
        }

        function openSkillModal(atk, tgt) {
            const m = document.getElementById('skill-modal');
            const l = document.getElementById('skill-list'); l.innerHTML='';
            atk.skills.forEach(s => {
                const b = document.createElement('div'); b.className='skill-btn';
                b.innerHTML=`<div>${s.name} (Â®ÅÂäõ:${s.power})</div><div style="font-size:10px; color:#555">${s.desc}</div>`;
                b.onclick=()=>{ executeSkill(atk, tgt, s); m.style.display='none'; };
                l.appendChild(b);
            });
            m.style.display='flex';
        }

        function executeSkill(atk, tgt, skill) {
            let log = `${skill.name}!`;
            if(skill.type==='aoe') {
                gs.enemyField.forEach(u=>u.currentHp-=skill.power); gs.enemyHp-=skill.power;
            } else if(skill.type==='aoe_heal') {
                gs.enemyField.forEach(u=>u.currentHp-=skill.power); gs.hp+=skill.power;
            } else if(skill.type==='heal') {
                gs.hp+=skill.power;
            } else {
                const dmg = skill.power;
                if(tgt==='leader') gs.enemyHp-=dmg;
                else {
                    const cnt = tgt.atk;
                    if(skill.type==='toxic' && dmg>0) tgt.currentHp=-99; else tgt.currentHp-=dmg;
                    atk.currentHp-=cnt;
                }
            }
            atk.canAttack=false; msg(log); cancelAttack(); checkEnd(); updateView();
        }

        function cancelAttack() { gs.attacker=null; document.body.classList.remove('targeting'); updateView(); }

        function checkEnd() {
            gs.field = gs.field.filter(u=>u.currentHp>0);
            gs.enemyField = gs.enemyField.filter(u=>u.currentHp>0);
            if(gs.enemyHp<=0) showResult(true);
            else if(gs.hp<=0) showResult(false);
        }

        function showResult(isWin) {
            const sc = document.getElementById('result-screen');
            const tit = document.getElementById('res-title');
            const ms = document.getElementById('res-msg');
            sc.style.display = 'flex';
            if(isWin) { tit.innerText="VICTORY"; tit.className="result-title res-win"; ms.innerText="„ÅÇ„Å™„Åü„ÅÆÂãùÂà©ÔºÅ"; }
            else { tit.innerText="DEFEAT"; tit.className="result-title res-lose"; ms.innerText="ÊïóÂåó„Åó„Åæ„Åó„Åü..."; }
        }

        function endTurn() {
            gs.isPlayerTurn=false; cancelAttack(); updateView(); msg("Êïµ„ÅÆ„Çø„Éº„É≥");
            setTimeout(cpuTurn, 1000);
        }

        async function cpuTurn() {
            if(gs.maxMp<10) gs.maxMp++; gs.mp=gs.maxMp;
            draw(false); updateView(); await sleep(500);
            
            // CPUÂêàÊàê (‰øÆÊ≠£ÁÇπ: gs.enemyRecipes„Çí‰ΩøÁî®)
            let acted=true;
            while(acted && gs.enemyField.length<MAX_FIELD) {
                acted=false;
                const hand = gs.enemyHand.map(c=>c.symbol);
                for(let r of gs.enemyRecipes) {
                    if(r.product.type==='spell') continue;
                    let ing=[...r.ingredients], tHand=[...hand], ok=true;
                    for(let i of ing) {
                        let idx=tHand.indexOf(i); if(idx===-1){ok=false;break;} tHand.splice(idx,1);
                    }
                    if(ok) {
                        for(let i of r.ingredients) {
                            let idx=gs.enemyHand.findIndex(c=>c.symbol===i); gs.enemyHand.splice(idx,1);
                        }
                        const u={...r.product, id:Math.random(), maxHp:r.product.hp, currentHp:r.product.hp, canAttack:false, type:'unit'};
                        gs.enemyField.push(u); msg(`CPUÂè¨Âñö: ${u.name}`);
                        await sleep(800); updateView(); acted=true; break;
                    }
                }
            }
            gs.enemyField.forEach(u=>u.canAttack=true);
            for(let u of gs.enemyField) {
                if(!u.canAttack) continue;
                const guards=gs.field.filter(g=>g.ability==='ward' && g.ability!=='stealth');
                let tgt='leader'; if(guards.length>0) tgt=guards[0];
                if(tgt==='leader') { gs.hp-=u.skills[0].power; msg("CPUÊîªÊíÉ"); }
                else { 
                    const dmg=u.skills[0].power; 
                    if(u.skills[0].type==='toxic' && dmg>0) tgt.currentHp=-99; else tgt.currentHp-=dmg;
                    u.currentHp-=tgt.atk; msg(`CPUÊîªÊíÉ -> ${tgt.name}`);
                }
                checkEnd(); updateView(); await sleep(800);
            }
            gs.turn++; gs.isPlayerTurn=true; gs.field.forEach(u=>u.canAttack=true);
            draw(true); msg("„ÅÇ„Å™„Åü„ÅÆ„Çø„Éº„É≥"); updateView();
        }
        const sleep = m => new Promise(r => setTimeout(r, m));

        function updateView() {
            document.getElementById('turn-display').innerText = `„Çø„Éº„É≥ ${gs.turn}`;
            document.getElementById('mp-display').innerText = `MP ${gs.mp}/${gs.maxMp}`;
            document.getElementById('player-hp').innerText = gs.hp;
            document.getElementById('enemy-hp').innerText = gs.enemyHp;
            document.getElementById('cancel-btn').style.display = gs.attacker ? 'block' : 'none';

            render(document.getElementById('player-hand-area'), gs.hand, 'hand', true);
            render(document.getElementById('player-field'), gs.field, 'field', true);
            render(document.getElementById('enemy-field'), gs.enemyField, 'field', false);
            
            const eh = document.getElementById('enemy-hand-area'); eh.innerHTML='';
            gs.enemyHand.forEach(()=>{
                const d=document.createElement('div'); d.className='card'; d.style.background='#444'; d.style.width='30px'; d.style.height='45px';
                eh.appendChild(d);
            });
            updateHint();
        }

        function render(el, list, type, isPlayer) {
            el.innerHTML='';
            list.forEach(c => {
                const d = document.createElement('div'); d.className='card';
                d.setAttribute('data-rarity', c.rarity);
                let art = c.css || 'art-solid';
                let content = '';
                if(c.type==='element') {
                    content = `<div class="card-art-area ${art} css-art"></div><div class="card-info-area"><div class="card-symbol" style="position:static; display:block; margin-top:5px;">${c.symbol}</div><div class="card-name">${c.name}</div></div>`;
                } else {
                    let badges = `<div class="ability-container">`;
                    if(c.ability === 'ward') badges += `<div class="badge badge-ward">üõ°Ô∏è</div>`;
                    if(c.ability === 'toxic') badges += `<div class="badge badge-toxic">‚ò†Ô∏è</div>`;
                    if(c.ability === 'storm') badges += `<div class="badge badge-storm">‚ö°</div>`;
                    badges += `</div>`;
                    content = `${badges}<div class="card-art-area ${art} css-art"></div><div class="card-info-area"><div class="card-symbol" style="color:var(--primary); position:static; display:block;">${c.symbol}</div><div class="card-name">${c.name}</div><div class="stats"><span class="stat-atk">‚öîÔ∏è${c.atk}</span><span class="stat-hp">‚ù§Ô∏è${c.currentHp}</span></div></div>`;
                }
                d.innerHTML = content;
                
                if(type==='hand' && gs.selected.includes(c.id)) d.classList.add('selected');
                if(type==='field' && c.canAttack && isPlayer) d.classList.add('can-attack');
                if(type==='field' && !isPlayer && gs.attacker) d.classList.add('valid-target');

                d.onclick = (e) => { e.stopPropagation(); if(type==='hand') onHandClick(c.id); else onFieldClick(c.id, isPlayer); };
                el.appendChild(d);
            });
        }

        function updateHint() {
            const list = document.getElementById('craftable-list'); list.innerHTML='';
            if(!gs.isPlayerTurn) return;
            // ‚òÖ‰øÆÊ≠£ÁÇπ: gs.playerRecipes„Çí‰Ωø„ÅÜ
            gs.playerRecipes.forEach(r => {
                const handSym = gs.hand.map(c=>c.symbol);
                let possible = true;
                for(let ing of r.ingredients) {
                    const idx = handSym.indexOf(ing);
                    if(idx===-1) { possible=false; break; }
                    handSym.splice(idx,1);
                }
                if(possible) {
                    const b = document.createElement('div'); b.className='craft-btn';
                    b.innerText = `‚ú® ${r.product.name}`;
                    b.onclick = () => {
                        gs.selected = []; const tempHand=[...gs.hand];
                        r.ingredients.forEach(ing => {
                            const idx = tempHand.findIndex(x=>x.symbol===ing);
                            if(idx!==-1) { gs.selected.push(tempHand[idx].id); tempHand.splice(idx,1); }
                        });
                        updateView();
                    };
                    list.appendChild(b);
                }
            });
        }

        function showDetail(c) {
            const p = document.getElementById('detail-panel'); p.style.display='flex';
            document.getElementById('det-sym').innerText = c.symbol;
            document.getElementById('det-name').innerText = c.name;
            if(c.type!=='element') {
                document.getElementById('det-stats').innerHTML = `‚öîÔ∏è${c.atk} <span style="margin-left:10px; color:var(--success)">‚ù§Ô∏è${c.currentHp}/${c.maxHp}</span>`;
                document.getElementById('det-desc').innerHTML = (c.skills||[]).map(s=>`<div><b>„Äê${s.name}„Äë</b> ${s.desc}</div>`).join('');
            } else {
                document.getElementById('det-stats').innerText = '';
                document.getElementById('det-desc').innerText = 'ÂêàÊàêÁ¥†Êùê';
            }
        }

        function msg(t) { const b=document.getElementById('msg-box'); b.innerText=t; b.style.opacity=1; setTimeout(()=>b.style.opacity=0,1500); }

    </script>
</body>
</html>